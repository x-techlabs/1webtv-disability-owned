/**
 * One Studio Ads Plugin - v1.0.0 - 2023-04-05
 * Copyright (c) 2023 One Studio
 *               
 */

!function(e){"use strict";function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=t(e),r="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function a(e){var t=e.default;if("function"==typeof t){var n=function(){return t.apply(this,arguments)};n.prototype=t.prototype}else n={};return Object.defineProperty(n,"__esModule",{value:!0}),Object.keys(e).forEach((function(t){var r=Object.getOwnPropertyDescriptor(e,t);Object.defineProperty(n,t,r.get?r:{enumerable:!0,get:function(){return e[t]}})})),n}var i,o="undefined"!=typeof window?window:void 0!==r?r:"undefined"!=typeof self?self:{},s=void 0!==r?r:"undefined"!=typeof window?window:{},l=a(Object.freeze({__proto__:null,default:{}}));"undefined"!=typeof document?i=document:(i=s["__GLOBAL_DOCUMENT_CACHE@4"])||(i=s["__GLOBAL_DOCUMENT_CACHE@4"]=l);var d=i,u="6.9.0";
/*! @name videojs-contrib-ads @version 6.9.0 @license Apache-2.0 */var c=function(e,t){t.isImmediatePropagationStopped=function(){return!0},t.cancelBubble=!0,t.isPropagationStopped=function(){return!0}},h=function(e,t,n){c(0,n),e.trigger({type:t+n.type,originalEvent:n})};function p(e){"playing"===e.type?function(e,t){e.ads.isInAdMode()&&(e.ads.isContentResuming()?e.ads._contentEnding&&h(e,"content",t):h(e,"ad",t))}(this,e):"ended"===e.type?function(e,t){e.ads.isInAdMode()?e.ads.isContentResuming()?(c(0,t),e.trigger("resumeended")):h(e,"ad",t):e.ads._contentHasEnded||e.ads.stitchedAds()||(h(e,"content",t),e.trigger("readyforpostroll"))}(this,e):"loadstart"===e.type||"loadeddata"===e.type||"loadedmetadata"===e.type?function(e,t){if(!("loadstart"===t.type&&!e.ads._hasThereBeenALoadStartDuringPlayerLife||"loadeddata"===t.type&&!e.ads._hasThereBeenALoadedData||"loadedmetadata"===t.type&&!e.ads._hasThereBeenALoadedMetaData))if(e.ads.inAdBreak())h(e,"ad",t);else{if(e.currentSrc()!==e.ads.contentSrc)return;h(e,"content",t)}}(this,e):"play"===e.type?function(e,t){e.ads.inAdBreak()?h(e,"ad",t):e.ads.isContentResuming()&&h(e,"content",t)}(this,e):this.ads.isInAdMode()&&(this.ads.isContentResuming()?h(this,"content",e):h(this,"ad",e))}var f={},g=function(){!function(e){if(n.default.dom.isInFrame()&&"function"!=typeof o.__tcfapi){for(var t,r=o,a={};r;){try{if(r.frames.__tcfapiLocator){t=r;break}}catch(e){}if(r===o.top)break;r=r.parent}if(!t)return;o.__tcfapi=function(e,n,r,i){var o=Math.random()+"",s={__tcfapiCall:{command:e,parameter:i,version:n,callId:o}};a[o]=r,t.postMessage(s,"*")},o.addEventListener("message",(function(e){var t={};try{t="string"==typeof e.data?JSON.parse(e.data):e.data}catch(e){}var n=t.__tcfapiReturn;n&&"function"==typeof a[n.callId]&&(a[n.callId](n.returnValue,n.success),a[n.callId]=null)}),!1)}}(),"function"==typeof o.__tcfapi&&o.__tcfapi("addEventListener",2,(function(e,t){t&&(f=e)}))},m=function(e,t){return t?encodeURIComponent(e):e},v=function(e,t,n){if(e&&e[n])for(var r=e[n],a=Object.keys(r),i=0;i<a.length;i++){t["{mediainfo."+n+"."+a[i]+"}"]=r[a[i]]}};function y(e,t,r){var a=this,i={};e=e.replace(/{([^}=]+)=([^}]+)}/g,(function(e,t,n){return i["{"+t+"}"]=n,"{"+t+"}"})),void 0===t&&(t=!1);var s={};for(var l in void 0!==r&&(s=r),s["{player.id}"]=this.options_["data-player"]||this.id_,s["{player.height}"]=this.currentHeight(),s["{player.width}"]=this.currentWidth(),s["{mediainfo.id}"]=this.mediainfo?this.mediainfo.id:"",s["{mediainfo.name}"]=this.mediainfo?this.mediainfo.name:"",s["{mediainfo.duration}"]=this.mediainfo?this.mediainfo.duration:"",s["{player.duration}"]=this.duration(),s["{player.pageUrl}"]=n.default.dom.isInFrame()?d.referrer:o.location.href,s["{playlistinfo.id}"]=this.playlistinfo?this.playlistinfo.id:"",s["{playlistinfo.name}"]=this.playlistinfo?this.playlistinfo.name:"",s["{timestamp}"]=(new Date).getTime(),s["{document.referrer}"]=d.referrer,s["{window.location.href}"]=o.location.href,s["{random}"]=Math.floor(1e12*Math.random()),["description","tags","reference_id","ad_keys"].forEach((function(e){a.mediainfo&&a.mediainfo[e]?s["{mediainfo."+e+"}"]=a.mediainfo[e]:i["{mediainfo."+e+"}"]?s["{mediainfo."+e+"}"]=i["{mediainfo."+e+"}"]:s["{mediainfo."+e+"}"]=""})),v(this.mediainfo,s,"custom_fields"),v(this.mediainfo,s,"customFields"),Object.keys(f).forEach((function(e){s["{tcf."+e+"}"]=f[e]})),s["{tcf.gdprAppliesInt}"]=f.gdprApplies?1:0,s)e=e.split(l).join(m(s[l],t));for(var u in e=e.replace(/{pageVariable\.([^}]+)}/g,(function(e,r){for(var a,s=o,l=r.split("."),d=0;d<l.length;d++)d===l.length-1?a=s[l[d]]:s=s[l[d]];var u=typeof a;return null===a?"null":void 0===a?i["{pageVariable."+r+"}"]?i["{pageVariable."+r+"}"]:(n.default.log.warn('Page variable "'+r+'" not found'),""):"string"!==u&&"number"!==u&&"boolean"!==u?(n.default.log.warn('Page variable "'+r+'" is not a supported type'),""):m(String(a),t)})),i)e=e.replace(u,i[u]);return e}var A={processMetadataTracks:function(e,t){for(var n=e.textTracks(),r=function(n){"metadata"===n.kind&&(e.ads.cueTextTracks.setMetadataTrackMode(n),t(e,n))},a=0;a<n.length;a++)r(n[a]);n.addEventListener("addtrack",(function(e){r(e.track)}))},setMetadataTrackMode:function(e){},getSupportedAdCue:function(e,t){return t},isSupportedAdCue:function(e,t){return!0},getCueId:function(e,t){return t.id}},T=function(e,t){return void 0!==t&&e.ads.includedCues[t]},k=function(e,t){void 0!==t&&""!==t&&(e.ads.includedCues[t]=!0)};function b(){!1!==this.ads._shouldBlockPlay&&(this.paused()||(this.ads.debug("Playback was canceled by cancelContentPlay"),this.pause()),this.ads._cancelledPlay=!0)}A.processAdTrack=function(e,t,r,a){e.ads.includedCues={};for(var i=0;i<t.length;i++){var o=t[i],s=this.getSupportedAdCue(e,o);if(!this.isSupportedAdCue(e,o))return void n.default.log.warn("Skipping as this is not a supported ad cue.",o);var l=this.getCueId(e,o),d=o.startTime;if(T(e,l))return void n.default.log("Skipping ad already seen with ID "+l);a&&a(e,s,l,d),r(e,s,l,d),k(e,l)}};var C={},R=n.default;C.isMiddlewareMediatorSupported=function(){return!R.browser.IS_IOS&&!R.browser.IS_ANDROID&&!!(R.use&&R.middleware&&R.middleware.TERMINATOR)},C.playMiddleware=function(e){return{setSource:function(e,t){t(null,e)},callPlay:function(){if(e.ads&&!0===e.ads._shouldBlockPlay)return e.ads.debug("Using playMiddleware to block content playback"),e.ads._playBlocked=!0,R.middleware.TERMINATOR},play:function(t,r){e.ads&&e.ads._playBlocked&&t?(e.ads.debug("Play call to Tech was terminated."),e.trigger("play"),e.addClass("vjs-has-started"),e.ads._playBlocked=!1):r&&r.catch&&r.catch((function(t){"NotAllowedError"!==t.name||n.default.browser.IS_SAFARI||e.trigger("pause")}))}}},C.testHook=function(e){R=e};var E=C.playMiddleware,S=C.isMiddlewareMediatorSupported;var w=function(){function e(){}return e.getState=function(t){if(t)return e.states_&&e.states_[t]?e.states_[t]:void 0},e.registerState=function(t,n){if("string"!=typeof t||!t)throw new Error('Illegal state name, "'+t+'"; must be a non-empty string.');return e.states_||(e.states_={}),e.states_[t]=n,n},e}(),L=function(){function e(e){this.player=e}e._getName=function(){return"Anonymous State"};var t=e.prototype;return t.transitionTo=function(e){var t=this.player;this.cleanup(t);var n=new e(t);t.ads._state=n,t.ads.debug(this.constructor._getName()+" -> "+n.constructor._getName());for(var r=arguments.length,a=new Array(r>1?r-1:0),i=1;i<r;i++)a[i-1]=arguments[i];n.init.apply(n,[t].concat(a))},t.init=function(){},t.cleanup=function(){},t.onPlay=function(){},t.onPlaying=function(){},t.onEnded=function(){},t.onAdEnded=function(){},t.onAdsReady=function(){n.default.log.warn("Unexpected adsready event")},t.onAdsError=function(){},t.onAdsCanceled=function(){},t.onAdTimeout=function(){},t.onAdStarted=function(){},t.onContentChanged=function(){},t.onContentResumed=function(){},t.onReadyForPostroll=function(){n.default.log.warn("Unexpected readyforpostroll event")},t.onNoPreroll=function(){},t.onNoPostroll=function(){},t.startLinearAdMode=function(){n.default.log.warn("Unexpected startLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.endLinearAdMode=function(){n.default.log.warn("Unexpected endLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.skipLinearAdMode=function(){n.default.log.warn("Unexpected skipLinearAdMode invocation (State via "+this.constructor._getName()+")")},t.isAdState=function(){throw new Error("isAdState unimplemented for "+this.constructor._getName())},t.isWaitingForAdBreak=function(){return!1},t.isContentResuming=function(){return!1},t.inAdBreak=function(){return!1},t.handleEvent=function(e){var t=this.player;"play"===e?this.onPlay(t):"adsready"===e?this.onAdsReady(t):"adserror"===e?this.onAdsError(t):"adscanceled"===e?this.onAdsCanceled(t):"adtimeout"===e?this.onAdTimeout(t):"ads-ad-started"===e?this.onAdStarted(t):"contentchanged"===e?this.onContentChanged(t):"contentresumed"===e?this.onContentResumed(t):"readyforpostroll"===e?this.onReadyForPostroll(t):"playing"===e?this.onPlaying(t):"ended"===e?this.onEnded(t):"nopreroll"===e?this.onNoPreroll(t):"nopostroll"===e?this.onNoPostroll(t):"adended"===e&&this.onAdEnded(t)},e}();function N(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}w.registerState("State",L);var P=function(e){function t(t){var n;return(n=e.call(this,t)||this).contentResuming=!1,n.waitingForAdBreak=!1,n}N(t,e);var n=t.prototype;return n.isAdState=function(){return!0},n.onPlaying=function(){var e=w.getState("ContentPlayback");this.contentResuming&&this.transitionTo(e)},n.onContentResumed=function(){var e=w.getState("ContentPlayback");this.contentResuming&&this.transitionTo(e)},n.isWaitingForAdBreak=function(){return this.waitingForAdBreak},n.isContentResuming=function(){return this.contentResuming},n.inAdBreak=function(){return!0===this.player.ads._inLinearAdMode},t}(L);w.registerState("AdState",P);var _=function(e){function t(){return e.apply(this,arguments)||this}N(t,e);var n=t.prototype;return n.isAdState=function(){return!1},n.onContentChanged=function(e){var t=w.getState("BeforePreroll"),n=w.getState("Preroll");e.ads.debug("Received contentchanged event (ContentState)"),e.paused()?this.transitionTo(t):(this.transitionTo(n,!1),e.pause(),e.ads._pausedOnContentupdate=!0)},t}(L);w.registerState("ContentState",_);var I,U=function(e){function t(){return e.apply(this,arguments)||this}N(t,e),t._getName=function(){return"AdsDone"};var r=t.prototype;return r.init=function(e){e.ads._contentHasEnded=!0,e.trigger("ended")},r.startLinearAdMode=function(){n.default.log.warn("Unexpected startLinearAdMode invocation (AdsDone)")},t}(w.getState("ContentState"));w.registerState("AdsDone",U);var x={start:function(e){e.ads.debug("Starting ad break"),e.ads._inLinearAdMode=!0,e.trigger("adstart"),e.ads.shouldTakeSnapshots()&&(e.ads.snapshot=function(e){var t;t=n.default.browser.IS_IOS&&e.ads.isLive(e)&&e.seekable().length>0?e.currentTime()-e.seekable().end(0):e.currentTime();var r=e.$(".vjs-tech"),a=e.textTracks?e.textTracks():[],i=[],o={ended:e.ended(),currentSrc:e.currentSrc(),sources:e.currentSources(),src:e.tech_.src(),currentTime:t,type:e.currentType()};r&&(o.style=r.getAttribute("style"));for(var s=0;s<a.length;s++){var l=a[s];i.push({track:l,mode:l.mode}),l.mode="disabled"}return o.suppressedTracks=i,o}(e)),e.ads.shouldPlayContentBehindAd(e)&&(e.ads.preAdVolume_=e.volume(),e.volume(0)),e.addClass("vjs-ad-playing"),e.hasClass("vjs-live")&&e.removeClass("vjs-live"),e.ads.removeNativePoster()},end:function(e,t){e.ads.debug("Ending ad break"),void 0===t&&(t=function(){}),e.ads.adType=null,e.ads._inLinearAdMode=!1,e.trigger("adend"),e.removeClass("vjs-ad-playing"),e.ads.isLive(e)&&e.addClass("vjs-live"),e.ads.shouldTakeSnapshots()?function(e,t){var r=e.ads.snapshot;if(void 0===t&&(t=function(){}),!0===e.ads.disableNextSnapshotRestore)return e.ads.disableNextSnapshotRestore=!1,delete e.ads.snapshot,void t();var a,i=e.$(".vjs-tech"),o=20,s=r.suppressedTracks,l=function(){for(var e=0;e<s.length;e++)(a=s[e]).track.mode=a.mode},d=function(){var t;if(n.default.browser.IS_IOS&&e.ads.isLive(e)){if(r.currentTime<0&&(t=e.seekable().length>0?e.seekable().end(0)+r.currentTime:e.currentTime(),e.currentTime(t)),e.paused()){var a=e.play();a&&a.catch&&a.catch((function(e){n.default.log.warn("Play promise rejected in IOS snapshot resume",e)}))}}else if(r.ended)e.currentTime(e.duration());else{e.currentTime(r.currentTime);var i=e.play();i&&i.catch&&i.catch((function(e){n.default.log.warn("Play promise rejected in snapshot resume",e)}))}e.ads.shouldRemoveAutoplay_&&(e.autoplay(!1),e.ads.shouldRemoveAutoplay_=!1)},u=function t(){if(e.off("contentcanplay",t),I&&e.clearTimeout(I),(i=e.el().querySelector(".vjs-tech")).readyState>1)return d();if(void 0===i.seekable)return d();if(i.seekable.length>0)return d();if(o--)e.setTimeout(t,50);else try{d()}catch(e){n.default.log.warn("Failed to resume the content after an advertisement",e)}};if("style"in r&&i.setAttribute("style",r.style||""),e.ads.videoElementRecycled())e.one("resumeended",(function(){delete e.ads.snapshot,t()})),e.one("contentloadedmetadata",l),n.default.browser.IS_IOS&&!e.autoplay()&&(e.autoplay(!0),e.ads.shouldRemoveAutoplay_=!0),e.src(r.sources),e.one("contentcanplay",u),I=e.setTimeout(u,2e3);else{if(l(),!e.ended()){var c=e.play();c&&c.catch&&c.catch((function(e){n.default.log.warn("Play promise rejected in snapshot restore",e)}))}delete e.ads.snapshot,t()}}(e,t):(e.volume(e.ads.preAdVolume_),t())}},D=function(e){function t(){return e.apply(this,arguments)||this}N(t,e),t._getName=function(){return"Preroll"};var r=t.prototype;return r.init=function(e,t,n){if(this.waitingForAdBreak=!0,e.addClass("vjs-ad-loading"),n||e.ads.nopreroll_)return this.resumeAfterNoPreroll(e);var r=e.ads.settings.timeout;"number"==typeof e.ads.settings.prerollTimeout&&(r=e.ads.settings.prerollTimeout),this._timeout=e.setTimeout((function(){e.trigger("adtimeout")}),r),t?this.handleAdsReady():this.adsReady=!1},r.onAdsReady=function(e){e.ads.inAdBreak()?n.default.log.warn("Unexpected adsready event (Preroll)"):(e.ads.debug("Received adsready event (Preroll)"),this.handleAdsReady())},r.handleAdsReady=function(){this.adsReady=!0,this.readyForPreroll()},r.afterLoadStart=function(e){var t=this.player;t.ads._hasThereBeenALoadStartDuringPlayerLife?e():(t.ads.debug("Waiting for loadstart..."),t.one("loadstart",(function(){t.ads.debug("Received loadstart event"),e()})))},r.noPreroll=function(){var e=this;this.afterLoadStart((function(){e.player.ads.debug("Skipping prerolls due to nopreroll event (Preroll)"),e.resumeAfterNoPreroll(e.player)}))},r.readyForPreroll=function(){var e=this.player;this.afterLoadStart((function(){e.ads.debug("Triggered readyforpreroll event (Preroll)"),e.trigger("readyforpreroll")}))},r.onAdsCanceled=function(e){var t=this;e.ads.debug("adscanceled (Preroll)"),this.afterLoadStart((function(){t.resumeAfterNoPreroll(e)}))},r.onAdsError=function(e){var t=this;n.default.log("adserror (Preroll)"),this.inAdBreak()?e.ads.endLinearAdMode():this.afterLoadStart((function(){t.resumeAfterNoPreroll(e)}))},r.startLinearAdMode=function(){var e=this.player;!this.adsReady||e.ads.inAdBreak()||this.isContentResuming()?n.default.log.warn("Unexpected startLinearAdMode invocation (Preroll)"):(this.clearTimeout(e),e.ads.adType="preroll",this.waitingForAdBreak=!1,x.start(e),e.ads._shouldBlockPlay=!1)},r.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},r.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(e.removeClass("vjs-ad-loading"),e.addClass("vjs-ad-content-resuming"),this.contentResuming=!0,x.end(e))},r.skipLinearAdMode=function(){var e=this,t=this.player;t.ads.inAdBreak()||this.isContentResuming()?n.default.log.warn("Unexpected skipLinearAdMode invocation"):this.afterLoadStart((function(){t.trigger("adskip"),t.ads.debug("skipLinearAdMode (Preroll)"),e.resumeAfterNoPreroll(t)}))},r.onAdTimeout=function(e){var t=this;this.afterLoadStart((function(){e.ads.debug("adtimeout (Preroll)"),t.resumeAfterNoPreroll(e)}))},r.onNoPreroll=function(e){e.ads.inAdBreak()||this.isContentResuming()?n.default.log.warn("Unexpected nopreroll event (Preroll)"):this.noPreroll()},r.resumeAfterNoPreroll=function(e){if(this.contentResuming=!0,e.ads._shouldBlockPlay=!1,this.cleanupPartial(e),e.ads._playRequested||e.ads._pausedOnContentupdate)if(e.paused()){e.ads.debug("resumeAfterNoPreroll: attempting to resume playback (Preroll)");var t=e.play();t&&t.then&&t.then(null,(function(e){}))}else e.ads.debug("resumeAfterNoPreroll: already playing (Preroll)"),e.trigger("play"),e.trigger("playing")},r.cleanup=function(e){e.ads._hasThereBeenALoadStartDuringPlayerLife||n.default.log.warn("Leaving Preroll state before loadstart event can cause issues."),this.cleanupPartial(e)},r.cleanupPartial=function(e){e.removeClass("vjs-ad-loading"),e.removeClass("vjs-ad-content-resuming"),this.clearTimeout(e)},r.clearTimeout=function(e){e.clearTimeout(this._timeout),this._timeout=null},t}(w.getState("AdState"));w.registerState("Preroll",D);var M=function(e){function t(){return e.apply(this,arguments)||this}N(t,e),t._getName=function(){return"BeforePreroll"};var n=t.prototype;return n.init=function(e){this.adsReady=!1,this.shouldResumeToContent=!1,e.ads._shouldBlockPlay=!e.ads.settings.allowVjsAutoplay||!e.autoplay()},n.onAdsReady=function(e){e.ads.debug("Received adsready event (BeforePreroll)"),this.adsReady=!0},n.onPlay=function(e){var t=w.getState("Preroll");e.ads.debug("Received play event (BeforePreroll)"),this.transitionTo(t,this.adsReady,this.shouldResumeToContent)},n.onAdsCanceled=function(e){e.ads.debug("adscanceled (BeforePreroll)"),this.shouldResumeToContent=!0},n.onAdsError=function(){this.player.ads.debug("adserror (BeforePreroll)"),this.shouldResumeToContent=!0},n.onNoPreroll=function(){this.player.ads.debug("Skipping prerolls due to nopreroll event (BeforePreroll)"),this.shouldResumeToContent=!0},n.skipLinearAdMode=function(){var e=this.player;e.trigger("adskip"),e.ads.debug("skipLinearAdMode (BeforePreroll)"),this.shouldResumeToContent=!0},n.onContentChanged=function(){this.init(this.player)},t}(w.getState("ContentState"));w.registerState("BeforePreroll",M);var B=function(e){function t(){return e.apply(this,arguments)||this}N(t,e),t._getName=function(){return"Midroll"};var n=t.prototype;return n.init=function(e){e.ads.adType="midroll",x.start(e),e.addClass("vjs-ad-loading")},n.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},n.endLinearAdMode=function(){var e=this.player;this.inAdBreak()&&(this.contentResuming=!0,e.addClass("vjs-ad-content-resuming"),e.removeClass("vjs-ad-loading"),x.end(e))},n.onAdsError=function(e){this.inAdBreak()&&e.ads.endLinearAdMode()},n.cleanup=function(e){e.removeClass("vjs-ad-loading"),e.removeClass("vjs-ad-content-resuming")},t}(w.getState("AdState"));w.registerState("Midroll",B);var O=function(e){function t(){return e.apply(this,arguments)||this}N(t,e),t._getName=function(){return"Postroll"};var r=t.prototype;return r.init=function(e){if(this.waitingForAdBreak=!0,e.ads._contentEnding=!0,e.ads.nopostroll_){this.resumeContent(e);var t=w.getState("AdsDone");this.transitionTo(t)}else{e.addClass("vjs-ad-loading");var n=e.ads.settings.timeout;"number"==typeof e.ads.settings.postrollTimeout&&(n=e.ads.settings.postrollTimeout),this._postrollTimeout=e.setTimeout((function(){e.trigger("adtimeout")}),n)}},r.startLinearAdMode=function(){var e=this.player;e.ads.inAdBreak()||this.isContentResuming()?n.default.log.warn("Unexpected startLinearAdMode invocation (Postroll)"):(e.ads.adType="postroll",e.clearTimeout(this._postrollTimeout),this.waitingForAdBreak=!1,x.start(e))},r.onAdStarted=function(e){e.removeClass("vjs-ad-loading")},r.endLinearAdMode=function(){var e=this,t=this.player,n=w.getState("AdsDone");this.inAdBreak()&&(t.removeClass("vjs-ad-loading"),this.resumeContent(t),x.end(t,(function(){e.transitionTo(n)})))},r.skipLinearAdMode=function(){var e=this.player;e.ads.inAdBreak()||this.isContentResuming()?n.default.log.warn("Unexpected skipLinearAdMode invocation"):(e.ads.debug("Postroll abort (skipLinearAdMode)"),e.trigger("adskip"),this.abort(e))},r.onAdTimeout=function(e){e.ads.debug("Postroll abort (adtimeout)"),this.abort(e)},r.onAdsError=function(e){e.ads.debug("Postroll abort (adserror)"),e.ads.inAdBreak()?e.ads.endLinearAdMode():this.abort(e)},r.onContentChanged=function(e){if(this.isContentResuming()){var t=w.getState("BeforePreroll");this.transitionTo(t)}else if(!this.inAdBreak()){var n=w.getState("Preroll");this.transitionTo(n)}},r.onNoPostroll=function(e){this.isContentResuming()||this.inAdBreak()?n.default.log.warn("Unexpected nopostroll event (Postroll)"):this.abort(e)},r.resumeContent=function(e){this.contentResuming=!0,e.addClass("vjs-ad-content-resuming")},r.abort=function(e){var t=w.getState("AdsDone");this.resumeContent(e),e.removeClass("vjs-ad-loading"),this.transitionTo(t)},r.cleanup=function(e){e.removeClass("vjs-ad-content-resuming"),e.clearTimeout(this._postrollTimeout),e.ads._contentEnding=!1},t}(w.getState("AdState"));w.registerState("Postroll",O);var V=function(e){function t(){return e.apply(this,arguments)||this}N(t,e),t._getName=function(){return"ContentPlayback"};var n=t.prototype;return n.init=function(e){e.ads._shouldBlockPlay=!1},n.onAdsReady=function(e){e.ads.debug("Received adsready event (ContentPlayback)"),e.ads.nopreroll_||(e.ads.debug("Triggered readyforpreroll event (ContentPlayback)"),e.trigger("readyforpreroll"))},n.onReadyForPostroll=function(e){var t=w.getState("Postroll");e.ads.debug("Received readyforpostroll event"),this.transitionTo(t)},n.startLinearAdMode=function(){var e=w.getState("Midroll");this.transitionTo(e)},t}(w.getState("ContentState"));w.registerState("ContentPlayback",V);var j=function(e){function t(){return e.apply(this,arguments)||this}N(t,e),t._getName=function(){return"StitchedContentPlayback"};var n=t.prototype;return n.init=function(){this.player.ads._shouldBlockPlay=!1},n.onContentChanged=function(){this.player.ads.debug("Received contentchanged event ("+this.constructor._getName()+")")},n.startLinearAdMode=function(){var e=w.getState("StitchedAdRoll");this.transitionTo(e)},t}(w.getState("ContentState"));w.registerState("StitchedContentPlayback",j);var F=function(e){function t(){return e.apply(this,arguments)||this}N(t,e),t._getName=function(){return"StitchedAdRoll"};var n=t.prototype;return n.init=function(){this.waitingForAdBreak=!1,this.contentResuming=!1,this.player.ads.adType="stitched",x.start(this.player)},n.onPlaying=function(){},n.onContentResumed=function(){},n.onAdEnded=function(){this.endLinearAdMode(),this.player.trigger("ended")},n.endLinearAdMode=function(){var e=w.getState("StitchedContentPlayback");x.end(this.player),this.transitionTo(e)},t}(w.getState("AdState"));w.registerState("StitchedAdRoll",F);var W=C.isMiddlewareMediatorSupported,q=n.default.getTech("Html5").Events,H={timeout:5e3,prerollTimeout:void 0,postrollTimeout:void 0,debug:!1,stitchedAds:!1,contentIsLive:void 0,liveCuePoints:!0,allowVjsAutoplay:n.default.options.normalizeAutoplay||!1},z=function(e){var t=this,r=n.default.mergeOptions(H,e),a=[];q.concat(["firstplay","loadedalldata"]).forEach((function(e){-1===a.indexOf(e)&&a.push(e)})),t.on(a,p),W()||function(e,t){t&&n.default.log("Using cancelContentPlay to block content playback"),e.on("play",b)}(t,r.debug),t.setTimeout((function(){t.ads._hasThereBeenALoadStartDuringPlayerLife||""===t.src()||n.default.log.error("videojs-contrib-ads has not seen a loadstart event 5 seconds after being initialized, but a source is present. This indicates that videojs-contrib-ads was initialized too late. It must be initialized immediately after video.js in the same tick. As a result, some ads will not play and some media events will be incorrect. For more information, see http://videojs.github.io/videojs-contrib-ads/integrator/getting-started.html")}),5e3),t.on("ended",(function(){t.hasClass("vjs-has-started")||t.addClass("vjs-has-started")})),t.on("contenttimeupdate",(function(){t.removeClass("vjs-waiting")})),t.on(["addurationchange","adcanplay"],(function(){if(!t.ads.settings.stitchedAds&&!t.hasStarted()&&(!t.ads.snapshot||t.currentSrc()!==t.ads.snapshot.currentSrc)&&t.ads.inAdBreak()){var e=t.play();e&&e.catch&&e.catch((function(e){n.default.log.warn("Play promise rejected when playing ad",e)}))}})),t.on("nopreroll",(function(){t.ads.debug("Received nopreroll event"),t.ads.nopreroll_=!0})),t.on("nopostroll",(function(){t.ads.debug("Received nopostroll event"),t.ads.nopostroll_=!0})),t.on("playing",(function(){t.ads._cancelledPlay=!1,t.ads._pausedOnContentupdate=!1})),t.on("play",(function(){t.ads._playRequested=!0})),t.one("loadstart",(function(){t.ads._hasThereBeenALoadStartDuringPlayerLife=!0})),t.on("loadeddata",(function(){t.ads._hasThereBeenALoadedData=!0})),t.on("loadedmetadata",(function(){t.ads._hasThereBeenALoadedMetaData=!0})),t.ads=function(e){return{disableNextSnapshotRestore:!1,_contentEnding:!1,_contentHasEnded:!1,_hasThereBeenALoadStartDuringPlayerLife:!1,_hasThereBeenALoadedData:!1,_hasThereBeenALoadedMetaData:!1,_inLinearAdMode:!1,_shouldBlockPlay:!1,_playBlocked:!1,_playRequested:!1,adType:null,VERSION:u,reset:function(){e.ads.disableNextSnapshotRestore=!1,e.ads._contentEnding=!1,e.ads._contentHasEnded=!1,e.ads.snapshot=null,e.ads.adType=null,e.ads._hasThereBeenALoadedData=!1,e.ads._hasThereBeenALoadedMetaData=!1,e.ads._cancelledPlay=!1,e.ads._shouldBlockPlay=!1,e.ads._playBlocked=!1,e.ads.nopreroll_=!1,e.ads.nopostroll_=!1,e.ads._playRequested=!1},startLinearAdMode:function(){e.ads._state.startLinearAdMode()},endLinearAdMode:function(){e.ads._state.endLinearAdMode()},skipLinearAdMode:function(){e.ads._state.skipLinearAdMode()},stitchedAds:function(e){return void 0!==e&&(n.default.log.warn("Using player.ads.stitchedAds() as a setter is deprecated, it should be set as an option upon initialization of contrib-ads."),this.settings.stitchedAds=!!e),this.settings.stitchedAds},videoElementRecycled:function(){if(e.ads.shouldPlayContentBehindAd(e))return!1;if(!this.snapshot)throw new Error("You cannot use videoElementRecycled while there is no snapshot.");var t=e.tech_.src()!==this.snapshot.src,n=e.currentSrc()!==this.snapshot.currentSrc;return t||n},isLive:function(t){return void 0===t&&(t=e),"boolean"==typeof t.ads.settings.contentIsLive?t.ads.settings.contentIsLive:t.duration()===1/0||"8"===n.default.browser.IOS_VERSION&&0===t.duration()},shouldPlayContentBehindAd:function(t){if(void 0===t&&(t=e),t)return!!t.ads.settings.liveCuePoints&&!n.default.browser.IS_IOS&&!n.default.browser.IS_ANDROID&&t.duration()===1/0;throw new Error("shouldPlayContentBehindAd requires a player as a param")},shouldTakeSnapshots:function(t){return void 0===t&&(t=e),!this.shouldPlayContentBehindAd(t)&&!this.stitchedAds()},isInAdMode:function(){return this._state.isAdState()},isWaitingForAdBreak:function(){return this._state.isWaitingForAdBreak()},isContentResuming:function(){return this._state.isContentResuming()},isAdPlaying:function(){return this._state.inAdBreak()},inAdBreak:function(){return this._state.inAdBreak()},removeNativePoster:function(){var t=e.$(".vjs-tech");t&&t.removeAttribute("poster")},debug:function(){if(this.settings.debug){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];1===t.length&&"string"==typeof t[0]?n.default.log("ADS: "+t[0]):n.default.log.apply(n.default,["ADS:"].concat(t))}}}}(t),t.ads.settings=r,r.stitchedAds=!!r.stitchedAds,r.stitchedAds?t.ads._state=new(w.getState("StitchedContentPlayback"))(t):t.ads._state=new(w.getState("BeforePreroll"))(t),t.ads._state.init(t),t.ads.cueTextTracks=A,t.ads.adMacroReplacement=y.bind(t),function(e){e.ads.contentSrc=e.currentSrc(),e.ads._seenInitialLoadstart=!1,e.on("loadstart",(function(){if(!e.ads.inAdBreak()){var t=e.currentSrc();t!==e.ads.contentSrc&&(e.ads._seenInitialLoadstart&&e.trigger({type:"contentchanged"}),e.trigger({type:"contentupdate",oldValue:e.ads.contentSrc,newValue:t}),e.ads.contentSrc=t),e.ads._seenInitialLoadstart=!0}}))}(t),t.on("contentchanged",t.ads.reset);var i=function(){var e=t.textTracks();if(!t.ads.shouldPlayContentBehindAd(t)&&t.ads.inAdBreak()&&t.tech_.featuresNativeTextTracks&&n.default.browser.IS_IOS&&!Array.isArray(t.textTracks()))for(var r=0;r<e.length;r++){var a=e[r];"showing"===a.mode&&(a.mode="disabled")}};t.ready((function(){t.textTracks().addEventListener("change",i)})),t.on(["play","playing","ended","adsready","adscanceled","adskip","adserror","adtimeout","adended","ads-ad-started","contentchanged","dispose","contentresumed","readyforpostroll","nopreroll","nopostroll"],(function(e){t.ads._state.handleEvent(e.type)})),t.on("dispose",(function(){t.ads.reset(),t.textTracks().removeEventListener("change",i)})),g(),t.ads.listenToTcf=g};z.VERSION=u,function(e){!function(){if(n.default.getPlugin)return Boolean(n.default.getPlugin("ads"));var e=n.default.getComponent("Player");return Boolean(e&&e.prototype.ads)}()&&((n.default.registerPlugin||n.default.plugin)("ads",e),S()&&!n.default.usingContribAdsMiddleware_&&(n.default.use("*",E),n.default.usingContribAdsMiddleware_=!0,n.default.log.debug("Play middleware has been registered with videojs")))}(z);const G=n.default.getComponent("Component");G.registerComponent("adTime",class extends G{constructor(e,t){super(e,t),this._totalPodTime=0,e.on("addurationchange",(()=>this.onAdDurationChange())),e.adsConfig.vast?e.on("adtimeupdate",(()=>this.onAdVastProgress())):e.on("adtimeupdate",(()=>this.onAdsProgress())),e.on("ads-ad-ended",(()=>{this._totalPodTime=0})),e.on("adended",(()=>{this._totalPodTime+=this._adDuration}))}buildCSSClass(){return"vjs-ads-time"}createEl(){const e=super.createEl("div",{className:"vjs-ads-time"});return e.innerHTML="00:00",e}onAdDurationChange(){this.duration=this.player_.adsConfig.adTagDuration?this.player_.adsConfig.adTagDuration:this.player_.duration(),this._adDuration=this.player_.duration()}onAdVastProgress(){this.update(this.duration-(this._totalPodTime+this.player_.currentTime()))}onAdsProgress(){this.update(this.duration-this.player_.currentTime())}update(e){this.el_.innerHTML=n.default.formatTime(e)}});const Y=n.default.getComponent("Component");class K extends Y{createEl(){return super.createEl("div",{className:"vjs-ads-info-container"})}handleClick(e){this.player_.tracker&&this.player_.tracker.click()}}K.prototype.options_={children:["adTime"]},Y.registerComponent("adInfoContainer",K);const X=n.default.getComponent("Component");X.registerComponent("adTimeline",class extends X{constructor(e,t){super(e,t),this.originalPlayerState={},this._totalPodTime=0,this.onTimeUpdateRef=()=>this.onAdsProgress(),this.onVastTimeUpdateRef=()=>this.onAdVastProgress(),e.on("adstart",(()=>this.onAdStart())),e.on("adended",(()=>this.onAdEnded())),e.on("addurationchange",(()=>this.onAdDurationChange())),e.on("ads-ad-ended",(()=>{this._totalPodTime=0}))}createEl(){return super.createEl("div",{className:"vjs-ads-timeline"})}onAdDurationChange(){this.duration=this.player_.adsConfig.adTagDuration?this.player_.adsConfig.adTagDuration:this.player_.duration(),this._adDuration=this.player_.duration(),this.player_.adsConfig.vast?this.player_.on("adtimeupdate",this.onVastTimeUpdateRef):this.player_.on("adtimeupdate",this.onTimeUpdateRef)}onAdVastProgress(){const e=(this.player_.currentTime()+this._totalPodTime)/this.duration;this.width(100*e+"%")}onAdsProgress(){const e=this.player_.currentTime()/this.duration;this.width(100*e+"%")}onAdStart(){const e=this.player_,t=e.adsConfig;this.originalPlayerState.controlsEnabled=e.controls(),e.controls(t.controlsEnabled),this.originalPlayerState.seekEnabled=e.controlBar.progressControl.enabled(),t.seekEnabled?e.controlBar.progressControl.enable():e.controlBar.progressControl.disable()}onAdEnded(){const e=this.player_;this._totalPodTime+=this._adDuration,this.width("0%"),e.controls(this.originalPlayerState.controlsEnabled),this.originalPlayerState.seekEnabled?e.controlBar.progressControl.enable():e.controlBar.progressControl.disable(),e.off("adtimeupdate",this.onTimeUpdateRef)}});const Q=n.default.getComponent("Component");class $ extends Q{createEl(){return super.createEl("div",{className:"vjs-ads-timeline-container"})}}$.prototype.options_={children:["adTimeline"]},Q.registerComponent("adTimelineContainer",$);const Z=n.default.getComponent("Component");Z.registerComponent("adSkipRemaining",class extends Z{buildCSSClass(){return"vjs-ads-skip-remaining"}});const J=n.default.getComponent("Component");J.registerComponent("adPreSkip",class extends J{constructor(e,t){super(e,t),e.on("adskipremaining",((e,t)=>this.onSkipRemaining(e,t)))}createEl(e="div",t={},n={}){return this.tabIndex_=t.tabIndex,t={className:this.buildCSSClass()},super.createEl(e,t,n)}buildCSSClass(){return"vjs-ads-pre-skip vjs-control"}onSkipRemaining(e,t){this.el().innerHTML=t}});const ee=n.default.getComponent("Component");class te extends ee{constructor(e,t){super(e,t)}createEl(){return super.createEl("div",{className:"vjs-ads-container",dir:"ltr"})}}te.prototype.options_={children:["adInfoContainer","adTimelineContainer","adPreSkip"]},ee.registerComponent("AdsUI",te);const ne=n.default.getComponent("Button"),re=n.default.getComponent("Component");let ae=5;class ie extends ne{constructor(e,t){super(e,t),this.elapsedSkipTime=0,e.on("adstart",(()=>this.onAdStart()))}set skipDelay(e){ae=e}createEl(e,t={},n={}){t={className:this.buildCSSClass()},n={type:"button"};const r=re.prototype.createEl.call(this,"button",t,n);this.createControlTextEl(r);const a=re.prototype.createEl.call(this,"span",{className:"vjs-icon-placeholder"},{"aria-hidden":"true"});return r.appendChild(a),r}onAdStart(){this.onTimeUpdateRef=()=>this.onAdsProgress(),this.elapsedSkipTime=this.player_.currentTime(),this.player_.one("adtimeupdate",(()=>{this.elapsedSkipTime=this.player_.currentTime()})),this.player_.on("adtimeupdate",this.onTimeUpdateRef)}onAdsProgress(){const e=this.player_.currentTime()-this.elapsedSkipTime;e>=ae&&(this.player_.toggleClass("vjs-ad-is-pre-skippable",!1),this.player_.toggleClass("vjs-ad-is-skippable-now",!0),this.player_.off("adtimeupdate",this.onTimeUpdateRef)),this.player_.trigger("adskipremaining",~~(ae-e))}handleClick(e){this.player_.off("adtimeupdate",this.onTimeUpdateRef),this.player_.toggleClass("vjs-ad-is-skippable-now",!1),this.player_.trigger("adended"),this.player_.tracker&&this.player_.tracker.skip()}buildCSSClass(){return"vjs-ads-skip-button vjs-control"}}ie.prototype.controlText_="Skip Ad",re.registerComponent("adSkipButton",ie);var oe={exports:{}};(function(e){function t(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function n(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?t(Object(r),!0).forEach((function(t){s(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):t(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function r(e){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r(e)}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function u(e,t){return u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},u(e,t)}function c(e,t){if(t&&("object"==typeof t||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}function h(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=d(e);if(t){var a=d(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return c(this,n)}}function p(e){return function(e){if(Array.isArray(e))return f(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?f(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function g(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:e.id||null,adId:e.adId||null,sequence:e.sequence||null,apiFramework:e.apiFramework||null,universalAdIds:[],creativeExtensions:[]}}var m=["ADCATEGORIES","ADCOUNT","ADPLAYHEAD","ADSERVINGID","ADTYPE","APIFRAMEWORKS","APPBUNDLE","ASSETURI","BLOCKEDADCATEGORIES","BREAKMAXADLENGTH","BREAKMAXADS","BREAKMAXDURATION","BREAKMINADLENGTH","BREAKMINDURATION","BREAKPOSITION","CLICKPOS","CLICKTYPE","CLIENTUA","CONTENTID","CONTENTPLAYHEAD","CONTENTURI","DEVICEIP","DEVICEUA","DOMAIN","EXTENSIONS","GDPRCONSENT","IFA","IFATYPE","INVENTORYSTATE","LATLONG","LIMITADTRACKING","MEDIAMIME","MEDIAPLAYHEAD","OMIDPARTNER","PAGEURL","PLACEMENTTYPE","PLAYERCAPABILITIES","PLAYERSIZE","PLAYERSTATE","PODSEQUENCE","REGULATIONS","SERVERSIDE","SERVERUA","TRANSACTIONID","UNIVERSALADID","VASTVERSIONS","VERIFICATIONVENDORS"];function v(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=[],a=T(e);for(var i in!t.ERRORCODE||n.isCustomCode||/^[0-9]{3}$/.test(t.ERRORCODE)||(t.ERRORCODE=900),t.CACHEBUSTING=R(Math.round(1e8*Math.random())),t.TIMESTAMP=(new Date).toISOString(),t.RANDOM=t.random=t.CACHEBUSTING,t)t[i]=C(t[i]);for(var o in a){var s=a[o];"string"==typeof s&&r.push(y(s,t))}return r}function y(e,t){var n=(e=A(e,t)).match(/[^[\]]+(?=])/g);if(!n)return e;var r=n.filter((function(e){return m.indexOf(e)>-1}));return 0===r.length?e:A(e,r=r.reduce((function(e,t){return e[t]=-1,e}),{}))}function A(e,t){var n=e;for(var r in t){var a=t[r];n=n.replace(new RegExp("(?:\\[|%%)(".concat(r,")(?:\\]|%%)"),"g"),a)}return n}function T(e){return Array.isArray(e)?e.map((function(e){return e&&e.hasOwnProperty("url")?e.url:e})):e}function k(e,t){for(var n=0;n<t.length;n++)if(b(t[n],e))return!0;return!1}function b(e,t){if(e&&t){var n=Object.getOwnPropertyNames(e),r=Object.getOwnPropertyNames(t);return n.length===r.length&&e.id===t.id&&e.url===t.url}return!1}function C(e){return encodeURIComponent(e).replace(/[!'()*]/g,(function(e){return"%".concat(e.charCodeAt(0).toString(16))}))}function R(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:8;return e.toString().padStart(t,"0")}var E={track:function(e,t,n){v(e,t,n).forEach((function(e){"undefined"!=typeof window&&null!==window&&((new Image).src=e)}))},resolveURLTemplates:v,extractURLsFromTemplates:T,containsTemplateObject:k,isTemplateObjectEqual:b,encodeURIComponentRFC3986:C,replaceUrlMacros:y,isNumeric:function(e){return!isNaN(parseFloat(e))&&isFinite(e)},flatten:function e(t){return t.reduce((function(t,n){return t.concat(Array.isArray(n)?e(n):n)}),[])},joinArrayOfUniqueTemplateObjs:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=Array.isArray(e)?e:[],r=Array.isArray(t)?t:[];return n.concat(r).reduce((function(e,t){return k(t,e)||e.push(t),e}),[])},isValidTimeValue:function(e){return Number.isFinite(e)&&e>=-2},addLeadingZeros:R};function S(e){return-1!==["true","TRUE","True","1"].indexOf(e)}var w={childByName:function(e,t){var n=e.childNodes;for(var r in n){var a=n[r];if(a.nodeName===t)return a}},childrenByName:function(e,t){var n=[],r=e.childNodes;for(var a in r){var i=r[a];i.nodeName===t&&n.push(i)}return n},resolveVastAdTagURI:function(e,t){if(!t)return e;if(0===e.indexOf("//")){var n=location.protocol;return"".concat(n).concat(e)}if(-1===e.indexOf("://")){var r=t.slice(0,t.lastIndexOf("/"));return"".concat(r,"/").concat(e)}return e},parseBoolean:S,parseNodeText:function(e){return e&&(e.textContent||e.text||"").trim()},copyNodeAttribute:function(e,t,n){var r=t.getAttribute(e);r&&n.setAttribute(e,r)},parseAttributes:function(e){for(var t=e.attributes,n={},r=0;r<t.length;r++)n[t[r].nodeName]=t[r].nodeValue;return n},parseDuration:function(e){if(null==e)return-1;if(E.isNumeric(e))return parseInt(e);var t=e.split(":");if(3!==t.length)return-1;var n=t[2].split("."),r=parseInt(n[0]);2===n.length&&(r+=parseFloat("0.".concat(n[1])));var a=parseInt(60*t[1]),i=parseInt(60*t[0]*60);return isNaN(i)||isNaN(a)||isNaN(r)||a>3600||r>60?-1:i+a+r},splitVAST:function(e){var t=[],n=null;return e.forEach((function(r,a){if(r.sequence&&(r.sequence=parseInt(r.sequence,10)),r.sequence>1){var i=e[a-1];if(i&&i.sequence===r.sequence-1)return void(n&&n.push(r));delete r.sequence}n=[r],t.push(n)})),t},assignAttributes:function(e,t){if(e)for(var n in e){var r=e[n];if(r.nodeName&&r.nodeValue&&t.hasOwnProperty(r.nodeName)){var a=r.nodeValue;"boolean"==typeof t[r.nodeName]&&(a=S(a)),t[r.nodeName]=a}}},mergeWrapperAdData:function(e,t){e.errorURLTemplates=t.errorURLTemplates.concat(e.errorURLTemplates),e.impressionURLTemplates=t.impressionURLTemplates.concat(e.impressionURLTemplates),e.extensions=t.extensions.concat(e.extensions),t.viewableImpression.length>0&&(e.viewableImpression=[].concat(p(e.viewableImpression),p(t.viewableImpression))),e.followAdditionalWrappers=t.followAdditionalWrappers,e.allowMultipleAds=t.allowMultipleAds,e.fallbackOnNoAd=t.fallbackOnNoAd;var n=(t.creatives||[]).filter((function(e){return e&&"companion"===e.type})),r=n.reduce((function(e,t){return(t.variations||[]).forEach((function(t){(t.companionClickTrackingURLTemplates||[]).forEach((function(t){E.containsTemplateObject(t,e)||e.push(t)}))})),e}),[]);e.creatives=n.concat(e.creatives);var a=t.videoClickTrackingURLTemplates&&t.videoClickTrackingURLTemplates.length,i=t.videoCustomClickURLTemplates&&t.videoCustomClickURLTemplates.length;e.creatives.forEach((function(e){if(t.trackingEvents&&t.trackingEvents[e.type])for(var n in t.trackingEvents[e.type]){var o=t.trackingEvents[e.type][n];Array.isArray(e.trackingEvents[n])||(e.trackingEvents[n]=[]),e.trackingEvents[n]=e.trackingEvents[n].concat(o)}"linear"===e.type&&(a&&(e.videoClickTrackingURLTemplates=e.videoClickTrackingURLTemplates.concat(t.videoClickTrackingURLTemplates)),i&&(e.videoCustomClickURLTemplates=e.videoCustomClickURLTemplates.concat(t.videoCustomClickURLTemplates)),!t.videoClickThroughURLTemplate||null!==e.videoClickThroughURLTemplate&&void 0!==e.videoClickThroughURLTemplate||(e.videoClickThroughURLTemplate=t.videoClickThroughURLTemplate)),"companion"===e.type&&r.length&&(e.variations||[]).forEach((function(e){e.companionClickTrackingURLTemplates=E.joinArrayOfUniqueTemplateObjs(e.companionClickTrackingURLTemplates,r)}))})),t.adVerifications&&(e.adVerifications=e.adVerifications.concat(t.adVerifications)),t.blockedAdCategories&&(e.blockedAdCategories=e.blockedAdCategories.concat(t.blockedAdCategories))}};function L(e,t){var n=function(){var e=g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return{id:e.id,adId:e.adId,sequence:e.sequence,apiFramework:e.apiFramework,type:"companion",required:null,variations:[]}}(t);return n.required=e.getAttribute("required")||null,n.variations=w.childrenByName(e,"Companion").map((function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:e.id||null,adType:"companionAd",width:e.width||0,height:e.height||0,assetWidth:e.assetWidth||null,assetHeight:e.assetHeight||null,expandedWidth:e.expandedWidth||null,expandedHeight:e.expandedHeight||null,apiFramework:e.apiFramework||null,adSlotID:e.adSlotID||null,pxratio:e.pxratio||"1",renderingMode:e.renderingMode||"default",staticResources:[],htmlResources:[],iframeResources:[],adParameters:null,xmlEncoded:null,altText:null,companionClickThroughURLTemplate:null,companionClickTrackingURLTemplates:[],trackingEvents:{}}}(w.parseAttributes(e));t.htmlResources=w.childrenByName(e,"HTMLResource").reduce((function(e,t){var n=w.parseNodeText(t);return n?e.concat(n):e}),[]),t.iframeResources=w.childrenByName(e,"IFrameResource").reduce((function(e,t){var n=w.parseNodeText(t);return n?e.concat(n):e}),[]),t.staticResources=w.childrenByName(e,"StaticResource").reduce((function(e,t){var n=w.parseNodeText(t);return n?e.concat({url:n,creativeType:t.getAttribute("creativeType")||null}):e}),[]),t.altText=w.parseNodeText(w.childByName(e,"AltText"))||null;var n=w.childByName(e,"TrackingEvents");n&&w.childrenByName(n,"Tracking").forEach((function(e){var n=e.getAttribute("event"),r=w.parseNodeText(e);n&&r&&(Array.isArray(t.trackingEvents[n])||(t.trackingEvents[n]=[]),t.trackingEvents[n].push(r))})),t.companionClickTrackingURLTemplates=w.childrenByName(e,"CompanionClickTracking").map((function(e){return{id:e.getAttribute("id")||null,url:w.parseNodeText(e)}})),t.companionClickThroughURLTemplate=w.parseNodeText(w.childByName(e,"CompanionClickThrough"))||null;var r=w.childByName(e,"AdParameters");return r&&(t.adParameters=w.parseNodeText(r),t.xmlEncoded=r.getAttribute("xmlEncoded")||null),t})),n}function N(e){return"linear"===e.type}function P(e,t){var n,r=function(){var e=g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return{id:e.id,adId:e.adId,sequence:e.sequence,apiFramework:e.apiFramework,type:"linear",duration:0,skipDelay:null,mediaFiles:[],mezzanine:null,interactiveCreativeFile:null,closedCaptionFiles:[],videoClickThroughURLTemplate:null,videoClickTrackingURLTemplates:[],videoCustomClickURLTemplates:[],adParameters:null,icons:[],trackingEvents:{}}}(t);r.duration=w.parseDuration(w.parseNodeText(w.childByName(e,"Duration")));var a=e.getAttribute("skipoffset");if(null==a)r.skipDelay=null;else if("%"===a.charAt(a.length-1)&&-1!==r.duration){var i=parseInt(a,10);r.skipDelay=r.duration*(i/100)}else r.skipDelay=w.parseDuration(a);var o=w.childByName(e,"VideoClicks");if(o){var s=w.childByName(o,"ClickThrough");r.videoClickThroughURLTemplate=s?{id:s.getAttribute("id")||null,url:w.parseNodeText(s)}:null,w.childrenByName(o,"ClickTracking").forEach((function(e){r.videoClickTrackingURLTemplates.push({id:e.getAttribute("id")||null,url:w.parseNodeText(e)})})),w.childrenByName(o,"CustomClick").forEach((function(e){r.videoCustomClickURLTemplates.push({id:e.getAttribute("id")||null,url:w.parseNodeText(e)})}))}var l=w.childByName(e,"AdParameters");l&&(r.adParameters=w.parseNodeText(l)),w.childrenByName(e,"TrackingEvents").forEach((function(e){w.childrenByName(e,"Tracking").forEach((function(e){var t=e.getAttribute("event"),a=w.parseNodeText(e);if(t&&a){if("progress"===t){if(!(n=e.getAttribute("offset")))return;t="%"===n.charAt(n.length-1)?"progress-".concat(n):"progress-".concat(Math.round(w.parseDuration(n)))}Array.isArray(r.trackingEvents[t])||(r.trackingEvents[t]=[]),r.trackingEvents[t].push(a)}}))})),w.childrenByName(e,"MediaFiles").forEach((function(e){w.childrenByName(e,"MediaFile").forEach((function(e){r.mediaFiles.push(function(e){var t={id:null,fileURL:null,fileSize:0,deliveryType:"progressive",mimeType:null,mediaType:null,codec:null,bitrate:0,minBitrate:0,maxBitrate:0,width:0,height:0,apiFramework:null,scalable:null,maintainAspectRatio:null};t.id=e.getAttribute("id"),t.fileURL=w.parseNodeText(e),t.deliveryType=e.getAttribute("delivery"),t.codec=e.getAttribute("codec"),t.mimeType=e.getAttribute("type"),t.mediaType=e.getAttribute("mediaType")||"2D",t.apiFramework=e.getAttribute("apiFramework"),t.fileSize=parseInt(e.getAttribute("fileSize")||0),t.bitrate=parseInt(e.getAttribute("bitrate")||0),t.minBitrate=parseInt(e.getAttribute("minBitrate")||0),t.maxBitrate=parseInt(e.getAttribute("maxBitrate")||0),t.width=parseInt(e.getAttribute("width")||0),t.height=parseInt(e.getAttribute("height")||0);var n=e.getAttribute("scalable");n&&"string"==typeof n&&(t.scalable=w.parseBoolean(n));var r=e.getAttribute("maintainAspectRatio");return r&&"string"==typeof r&&(t.maintainAspectRatio=w.parseBoolean(r)),t}(e))}));var t=w.childByName(e,"InteractiveCreativeFile");t&&(r.interactiveCreativeFile=function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:e.type||null,apiFramework:e.apiFramework||null,variableDuration:w.parseBoolean(e.variableDuration),fileURL:null}}(w.parseAttributes(e));return t.fileURL=w.parseNodeText(e),t}(t));var n=w.childByName(e,"ClosedCaptionFiles");n&&w.childrenByName(n,"ClosedCaptionFile").forEach((function(e){var t=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{type:e.type||null,language:e.language||null,fileURL:null}}(w.parseAttributes(e));t.fileURL=w.parseNodeText(e),r.closedCaptionFiles.push(t)}));var a,i,o,s=w.childByName(e,"Mezzanine"),l=(a=s,i={},o=!1,["delivery","type","width","height"].forEach((function(e){a&&a.getAttribute(e)?i[e]=a.getAttribute(e):o=!0})),o?null:i);if(l){var d={id:null,fileURL:null,delivery:null,codec:null,type:null,width:0,height:0,fileSize:0,mediaType:"2D"};d.id=s.getAttribute("id"),d.fileURL=w.parseNodeText(s),d.delivery=l.delivery,d.codec=s.getAttribute("codec"),d.type=l.type,d.width=parseInt(l.width,10),d.height=parseInt(l.height,10),d.fileSize=parseInt(s.getAttribute("fileSize"),10),d.mediaType=s.getAttribute("mediaType")||"2D",r.mezzanine=d}}));var d=w.childByName(e,"Icons");return d&&w.childrenByName(d,"Icon").forEach((function(e){r.icons.push(function(e){var t={program:null,height:0,width:0,xPosition:0,yPosition:0,apiFramework:null,offset:null,duration:0,type:null,staticResource:null,htmlResource:null,iframeResource:null,pxratio:"1",iconClickThroughURLTemplate:null,iconClickTrackingURLTemplates:[],iconViewTrackingURLTemplate:null};t.program=e.getAttribute("program"),t.height=parseInt(e.getAttribute("height")||0),t.width=parseInt(e.getAttribute("width")||0),t.xPosition=function(e){return-1!==["left","right"].indexOf(e)?e:parseInt(e||0)}(e.getAttribute("xPosition")),t.yPosition=function(e){return-1!==["top","bottom"].indexOf(e)?e:parseInt(e||0)}(e.getAttribute("yPosition")),t.apiFramework=e.getAttribute("apiFramework"),t.pxratio=e.getAttribute("pxratio")||"1",t.offset=w.parseDuration(e.getAttribute("offset")),t.duration=w.parseDuration(e.getAttribute("duration")),w.childrenByName(e,"HTMLResource").forEach((function(e){t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=w.parseNodeText(e)})),w.childrenByName(e,"IFrameResource").forEach((function(e){t.type=e.getAttribute("creativeType")||0,t.iframeResource=w.parseNodeText(e)})),w.childrenByName(e,"StaticResource").forEach((function(e){t.type=e.getAttribute("creativeType")||0,t.staticResource=w.parseNodeText(e)}));var n=w.childByName(e,"IconClicks");return n&&(t.iconClickThroughURLTemplate=w.parseNodeText(w.childByName(n,"IconClickThrough")),w.childrenByName(n,"IconClickTracking").forEach((function(e){t.iconClickTrackingURLTemplates.push({id:e.getAttribute("id")||null,url:w.parseNodeText(e)})}))),t.iconViewTrackingURLTemplate=w.parseNodeText(w.childByName(e,"IconViewTracking")),t}(e))})),r}function _(e,t){var n=function(){var e=g(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{});return{id:e.id,adId:e.adId,sequence:e.sequence,apiFramework:e.apiFramework,type:"nonlinear",variations:[],trackingEvents:{}}}(t);return w.childrenByName(e,"TrackingEvents").forEach((function(e){var t,r;w.childrenByName(e,"Tracking").forEach((function(e){t=e.getAttribute("event"),r=w.parseNodeText(e),t&&r&&(Array.isArray(n.trackingEvents[t])||(n.trackingEvents[t]=[]),n.trackingEvents[t].push(r))}))})),w.childrenByName(e,"NonLinear").forEach((function(e){var t={id:null,width:0,height:0,expandedWidth:0,expandedHeight:0,scalable:!0,maintainAspectRatio:!0,minSuggestedDuration:0,apiFramework:"static",adType:"nonLinearAd",type:null,staticResource:null,htmlResource:null,iframeResource:null,nonlinearClickThroughURLTemplate:null,nonlinearClickTrackingURLTemplates:[],adParameters:null};t.id=e.getAttribute("id")||null,t.width=e.getAttribute("width"),t.height=e.getAttribute("height"),t.expandedWidth=e.getAttribute("expandedWidth"),t.expandedHeight=e.getAttribute("expandedHeight"),t.scalable=w.parseBoolean(e.getAttribute("scalable")),t.maintainAspectRatio=w.parseBoolean(e.getAttribute("maintainAspectRatio")),t.minSuggestedDuration=w.parseDuration(e.getAttribute("minSuggestedDuration")),t.apiFramework=e.getAttribute("apiFramework"),w.childrenByName(e,"HTMLResource").forEach((function(e){t.type=e.getAttribute("creativeType")||"text/html",t.htmlResource=w.parseNodeText(e)})),w.childrenByName(e,"IFrameResource").forEach((function(e){t.type=e.getAttribute("creativeType")||0,t.iframeResource=w.parseNodeText(e)})),w.childrenByName(e,"StaticResource").forEach((function(e){t.type=e.getAttribute("creativeType")||0,t.staticResource=w.parseNodeText(e)}));var r=w.childByName(e,"AdParameters");r&&(t.adParameters=w.parseNodeText(r)),t.nonlinearClickThroughURLTemplate=w.parseNodeText(w.childByName(e,"NonLinearClickThrough")),w.childrenByName(e,"NonLinearClickTracking").forEach((function(e){t.nonlinearClickTrackingURLTemplates.push({id:e.getAttribute("id")||null,url:w.parseNodeText(e)})})),n.variations.push(t)})),n}function I(e){var t=[];return e.forEach((function(e){var n=U(e);n&&t.push(n)})),t}function U(e){if("#comment"===e.nodeName)return null;var t,n={name:null,value:null,attributes:{},children:[]},r=e.attributes,a=e.childNodes;if(n.name=e.nodeName,e.attributes)for(var i in r)if(r.hasOwnProperty(i)){var o=r[i];o.nodeName&&o.nodeValue&&(n.attributes[o.nodeName]=o.nodeValue)}for(var s in a)if(a.hasOwnProperty(s)){var l=U(a[s]);l&&n.children.push(l)}if(0===n.children.length||1===n.children.length&&["#cdata-section","#text"].indexOf(n.children[0].name)>=0){var d=w.parseNodeText(e);""!==d&&(n.value=d),n.children=[]}return null===(t=n).value&&0===Object.keys(t.attributes).length&&0===t.children.length?null:n}function x(e){var t=[];return e.forEach((function(e){var n,r={id:e.getAttribute("id")||null,adId:D(e),sequence:e.getAttribute("sequence")||null,apiFramework:e.getAttribute("apiFramework")||null},a=[];w.childrenByName(e,"UniversalAdId").forEach((function(e){var t={idRegistry:e.getAttribute("idRegistry")||"unknown",value:w.parseNodeText(e)};a.push(t)}));var i=w.childByName(e,"CreativeExtensions");for(var o in i&&(n=I(w.childrenByName(i,"CreativeExtension"))),e.childNodes){var s=e.childNodes[o],l=void 0;switch(s.nodeName){case"Linear":l=P(s,r);break;case"NonLinearAds":l=_(s,r);break;case"CompanionAds":l=L(s,r)}l&&(a&&(l.universalAdIds=a),n&&(l.creativeExtensions=n),t.push(l))}})),t}function D(e){return e.getAttribute("AdID")||e.getAttribute("adID")||e.getAttribute("adId")||null}var M={Wrapper:{subElements:["VASTAdTagURI","Impression"]},BlockedAdCategories:{attributes:["authority"]},InLine:{subElements:["AdSystem","AdTitle","Impression","AdServingId","Creatives"]},Category:{attributes:["authority"]},Pricing:{attributes:["model","currency"]},Verification:{oneOfinLineResources:["JavaScriptResource","ExecutableResource"],attributes:["vendor"]},UniversalAdId:{attributes:["idRegistry"]},JavaScriptResource:{attributes:["apiFramework","browserOptional"]},ExecutableResource:{attributes:["apiFramework","type"]},Tracking:{attributes:["event"]},Creatives:{subElements:["Creative"]},Creative:{subElements:["UniversalAdId"]},Linear:{subElements:["MediaFiles","Duration"]},MediaFiles:{subElements:["MediaFile"]},MediaFile:{attributes:["delivery","type","width","height"]},Mezzanine:{attributes:["delivery","type","width","height"]},NonLinear:{oneOfinLineResources:["StaticResource","IFrameResource","HTMLResource"],attributes:["width","height"]},Companion:{oneOfinLineResources:["StaticResource","IFrameResource","HTMLResource"],attributes:["width","height"]},StaticResource:{attributes:["creativeType"]},Icons:{subElements:["Icon"]},Icon:{oneOfinLineResources:["StaticResource","IFrameResource","HTMLResource"]}};function B(e,t){if(M[e.nodeName]&&M[e.nodeName].attributes){var n=M[e.nodeName].attributes.filter((function(t){return!e.getAttribute(t)}));n.length>0&&j({name:e.nodeName,parentName:e.parentNode.nodeName,attributes:n},t)}}function O(e,t,n){var r=M[e.nodeName],a=!n&&"Wrapper"!==e.nodeName;if(r&&!a){if(r.subElements){var i=r.subElements.filter((function(t){return!w.childByName(e,t)}));i.length>0&&j({name:e.nodeName,parentName:e.parentNode.nodeName,subElements:i},t)}n&&r.oneOfinLineResources&&(r.oneOfinLineResources.some((function(t){return w.childByName(e,t)}))||j({name:e.nodeName,parentName:e.parentNode.nodeName,oneOfResources:r.oneOfinLineResources},t))}}function V(e){return e.children&&0!==e.children.length}function j(e,t){var n=e.name,r=e.parentName,a=e.attributes,i=e.subElements,o=e.oneOfResources,s="Element '".concat(n,"'");t("VAST-warning",{message:s+=a?" missing required attribute(s) '".concat(a.join(", "),"' "):i?" missing required sub element(s) '".concat(i.join(", "),"' "):o?" must provide one of the following '".concat(o.join(", "),"' "):" is empty",parentElement:r,specVersion:4.1})}var F={verifyRequiredValues:function e(t,n,r){if(t&&t.nodeName)if("InLine"===t.nodeName&&(r=!0),B(t,n),V(t)){O(t,n,r);for(var a=0;a<t.children.length;a++)e(t.children[a],n,r)}else 0===w.parseNodeText(t).length&&j({name:t.nodeName,parentName:t.parentNode.nodeName},n)},hasSubElements:V,emitMissingValueWarning:j,verifyRequiredAttributes:B,verifyRequiredSubElements:O};function W(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.allowMultipleAds,a=n.followAdditionalWrappers,i=e.childNodes;for(var o in i){var s=i[o];if(-1!==["Wrapper","InLine"].indexOf(s.nodeName)&&("Wrapper"!==s.nodeName||!1!==a)){if(w.copyNodeAttribute("id",e,s),w.copyNodeAttribute("sequence",e,s),w.copyNodeAttribute("adType",e,s),"Wrapper"===s.nodeName)return{ad:z(s,t),type:"WRAPPER"};if("InLine"===s.nodeName)return{ad:q(s,t,{allowMultipleAds:r}),type:"INLINE"}}}}function q(e,t){return!1===(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).allowMultipleAds&&e.getAttribute("sequence")?null:H(e,t)}function H(e,t){var n=[];t&&F.verifyRequiredValues(e,t);var r=e.childNodes,a=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{id:e.id||null,sequence:e.sequence||null,adType:e.adType||null,adServingId:null,categories:[],expires:null,viewableImpression:[],system:null,title:null,description:null,advertiser:null,pricing:null,survey:null,errorURLTemplates:[],impressionURLTemplates:[],creatives:[],extensions:[],adVerifications:[],blockedAdCategories:[],followAdditionalWrappers:!0,allowMultipleAds:!1,fallbackOnNoAd:null}}(w.parseAttributes(e));for(var i in r){var o=r[i];switch(o.nodeName){case"Error":a.errorURLTemplates.push(w.parseNodeText(o));break;case"Impression":a.impressionURLTemplates.push({id:o.getAttribute("id")||null,url:w.parseNodeText(o)});break;case"Creatives":a.creatives=x(w.childrenByName(o,"Creative"));break;case"Extensions":var s=w.childrenByName(o,"Extension");a.extensions=I(s),a.adVerifications.length||(n=Y(s));break;case"AdVerifications":a.adVerifications=G(w.childrenByName(o,"Verification"));break;case"AdSystem":a.system={value:w.parseNodeText(o),version:o.getAttribute("version")||null};break;case"AdTitle":a.title=w.parseNodeText(o);break;case"AdServingId":a.adServingId=w.parseNodeText(o);break;case"Category":a.categories.push({authority:o.getAttribute("authority")||null,value:w.parseNodeText(o)});break;case"Expires":a.expires=parseInt(w.parseNodeText(o),10);break;case"ViewableImpression":a.viewableImpression.push(K(o));break;case"Description":a.description=w.parseNodeText(o);break;case"Advertiser":a.advertiser={id:o.getAttribute("id")||null,value:w.parseNodeText(o)};break;case"Pricing":a.pricing={value:w.parseNodeText(o),model:o.getAttribute("model")||null,currency:o.getAttribute("currency")||null};break;case"Survey":a.survey=w.parseNodeText(o);break;case"BlockedAdCategories":a.blockedAdCategories.push({authority:o.getAttribute("authority")||null,value:w.parseNodeText(o)})}}return n.length&&(a.adVerifications=a.adVerifications.concat(n)),a}function z(e,t){var n=H(e,t),r=e.getAttribute("followAdditionalWrappers"),a=e.getAttribute("allowMultipleAds"),i=e.getAttribute("fallbackOnNoAd");n.followAdditionalWrappers=!r||w.parseBoolean(r),n.allowMultipleAds=!!a&&w.parseBoolean(a),n.fallbackOnNoAd=i?w.parseBoolean(i):null;var o=w.childByName(e,"VASTAdTagURI");if(o?n.nextWrapperURL=w.parseNodeText(o):(o=w.childByName(e,"VASTAdTagURL"))&&(n.nextWrapperURL=w.parseNodeText(w.childByName(o,"URL"))),n.creatives.forEach((function(e){if(-1!==["linear","nonlinear"].indexOf(e.type)){if(e.trackingEvents){n.trackingEvents||(n.trackingEvents={}),n.trackingEvents[e.type]||(n.trackingEvents[e.type]={});var t=function(t){var r=e.trackingEvents[t];Array.isArray(n.trackingEvents[e.type][t])||(n.trackingEvents[e.type][t]=[]),r.forEach((function(r){n.trackingEvents[e.type][t].push(r)}))};for(var r in e.trackingEvents)t(r)}e.videoClickTrackingURLTemplates&&(Array.isArray(n.videoClickTrackingURLTemplates)||(n.videoClickTrackingURLTemplates=[]),e.videoClickTrackingURLTemplates.forEach((function(e){n.videoClickTrackingURLTemplates.push(e)}))),e.videoClickThroughURLTemplate&&(n.videoClickThroughURLTemplate=e.videoClickThroughURLTemplate),e.videoCustomClickURLTemplates&&(Array.isArray(n.videoCustomClickURLTemplates)||(n.videoCustomClickURLTemplates=[]),e.videoCustomClickURLTemplates.forEach((function(e){n.videoCustomClickURLTemplates.push(e)})))}})),n.nextWrapperURL)return n}function G(e){var t=[];return e.forEach((function(e){var n={resource:null,vendor:null,browserOptional:!1,apiFramework:null,type:null,parameters:null,trackingEvents:{}},r=e.childNodes;for(var a in w.assignAttributes(e.attributes,n),r){var i=r[a];switch(i.nodeName){case"JavaScriptResource":case"ExecutableResource":n.resource=w.parseNodeText(i),w.assignAttributes(i.attributes,n);break;case"VerificationParameters":n.parameters=w.parseNodeText(i)}}var o=w.childByName(e,"TrackingEvents");o&&w.childrenByName(o,"Tracking").forEach((function(e){var t=e.getAttribute("event"),r=w.parseNodeText(e);t&&r&&(Array.isArray(n.trackingEvents[t])||(n.trackingEvents[t]=[]),n.trackingEvents[t].push(r))})),t.push(n)})),t}function Y(e){var t=null,n=[];return e.some((function(e){return t=w.childByName(e,"AdVerifications")})),t&&(n=G(w.childrenByName(t,"Verification"))),n}function K(e){var t={};t.id=e.getAttribute("id")||null;var n=e.childNodes;for(var r in n){var a=n[r],i=a.nodeName,o=w.parseNodeText(a);if(("Viewable"===i||"NotViewable"===i||"ViewUndetermined"===i)&&o){var s=i.toLowerCase();Array.isArray(t[s])||(t[s]=[]),t[s].push(o)}}return t}var X=function(){function e(){a(this,e),this._handlers=[]}return o(e,[{key:"on",value:function(e,t){if("function"!=typeof t)throw new TypeError("The handler argument must be of type Function. Received type ".concat(r(t)));if(!e)throw new TypeError("The event argument must be of type String. Received type ".concat(r(e)));return this._handlers.push({event:e,handler:t}),this}},{key:"once",value:function(e,t){return this.on(e,function(e,t,n){var r={fired:!1,wrapFn:void 0};function a(){r.fired||(e.off(t,r.wrapFn),r.fired=!0,n.bind(e).apply(void 0,arguments))}return r.wrapFn=a,a}(this,e,t))}},{key:"off",value:function(e,t){return this._handlers=this._handlers.filter((function(n){return n.event!==e||n.handler!==t})),this}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var a=!1;return this._handlers.forEach((function(t){"*"===t.event&&(a=!0,t.handler.apply(t,[e].concat(n))),t.event===e&&(a=!0,t.handler.apply(t,n))})),a}},{key:"removeAllListeners",value:function(e){return e?(this._handlers=this._handlers.filter((function(t){return t.event!==e})),this):(this._handlers=[],this)}},{key:"listenerCount",value:function(e){return this._handlers.filter((function(t){return t.event===e})).length}},{key:"listeners",value:function(e){return this._handlers.reduce((function(t,n){return n.event===e&&t.push(n.handler),t}),[])}},{key:"eventNames",value:function(){return this._handlers.map((function(e){return e.event}))}}]),e}(),Q={get:function(e,t,n){n(new Error("Please bundle the library for node to use the node urlHandler"))}},$=12e4;function Z(){try{var e=new window.XMLHttpRequest;return"withCredentials"in e?e:null}catch(e){return null}}function J(e,t,n){var r=n?408:e.status,a=n?"XHRURLHandler: Request timed out after ".concat(e.timeout," ms (").concat(r,")"):"XHRURLHandler: ".concat(e.statusText," (").concat(r,")");t(new Error(a),null,{statusCode:r})}var ee={get:function(e,t,n){if("https:"===window.location.protocol&&0===e.indexOf("http://"))return n(new Error("XHRURLHandler: Cannot go from HTTPS to HTTP."));try{var r=Z();r.open("GET",e),r.timeout=t.timeout||$,r.withCredentials=t.withCredentials||!1,r.overrideMimeType&&r.overrideMimeType("text/xml"),r.onload=function(){return function(e,t){200===e.status?t(null,e.responseXML,{byteLength:e.response.length,statusCode:e.status}):J(e,t,!1)}(r,n)},r.onerror=function(){return J(r,n,!1)},r.onabort=function(){return J(r,n,!1)},r.ontimeout=function(){return J(r,n,!0)},r.send()}catch(e){n(new Error("XHRURLHandler: Unexpected error"))}},supported:function(){return!!Z()}},te={get:function(e,t,n){return n||("function"==typeof t&&(n=t),t={}),"undefined"==typeof window||null===window?Q.get(e,t,n):ee.supported()?ee.get(e,t,n):n(new Error("Current context is not supported by any of the default URLHandlers. Please provide a custom URLHandler"))}},ne=0,re=0,ae=function(e,t){!e||!t||e<=0||t<=0||(re=(re*ne+8*e/t)/++ne)},ie={ERRORCODE:900,extensions:[]},oe=function(e){l(n,e);var t=h(n);function n(){var e;return a(this,n),(e=t.call(this)).remainingAds=[],e.parentURLs=[],e.errorURLTemplates=[],e.rootErrorURLTemplates=[],e.maxWrapperDepth=null,e.URLTemplateFilters=[],e.fetchingOptions={},e.parsingOptions={},e}return o(n,[{key:"addURLTemplateFilter",value:function(e){"function"==typeof e&&this.URLTemplateFilters.push(e)}},{key:"removeURLTemplateFilter",value:function(){this.URLTemplateFilters.pop()}},{key:"countURLTemplateFilters",value:function(){return this.URLTemplateFilters.length}},{key:"clearURLTemplateFilters",value:function(){this.URLTemplateFilters=[]}},{key:"trackVastError",value:function(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),a=2;a<n;a++)r[a-2]=arguments[a];this.emit("VAST-error",Object.assign.apply(Object,[{},ie,t].concat(r))),E.track(e,t)}},{key:"getErrorURLTemplates",value:function(){return this.rootErrorURLTemplates.concat(this.errorURLTemplates)}},{key:"getEstimatedBitrate",value:function(){return re}},{key:"fetchVAST",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;return new Promise((function(i,o){t.URLTemplateFilters.forEach((function(t){e=t(e)})),t.parentURLs.push(e);var s=Date.now();t.emit("VAST-resolving",{url:e,previousUrl:r,wrapperDepth:n,maxWrapperDepth:t.maxWrapperDepth,timeout:t.fetchingOptions.timeout,wrapperAd:a}),t.urlHandler.get(e,t.fetchingOptions,(function(a,l){var d=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},u=Math.round(Date.now()-s),c=Object.assign({url:e,previousUrl:r,wrapperDepth:n,error:a,duration:u},d);t.emit("VAST-resolved",c),ae(d.byteLength,u),a?o(a):i(l)}))}))}},{key:"initParsingStatus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.errorURLTemplates=[],this.fetchingOptions={timeout:e.timeout||$,withCredentials:e.withCredentials},this.maxWrapperDepth=e.wrapperLimit||10,this.parentURLs=[],this.parsingOptions={allowMultipleAds:e.allowMultipleAds},this.remainingAds=[],this.rootErrorURLTemplates=[],this.rootURL="",this.urlHandler=e.urlHandler||e.urlhandler||te,this.vastVersion=null,ae(e.byteLength,e.requestDuration)}},{key:"getRemainingAds",value:function(e){var t=this;if(0===this.remainingAds.length)return Promise.reject(new Error("No more ads are available for the given VAST"));var n=e?E.flatten(this.remainingAds):this.remainingAds.shift();return this.errorURLTemplates=[],this.parentURLs=[],this.resolveAds(n,{wrapperDepth:0,url:this.rootURL}).then((function(e){return t.buildVASTResponse(e)}))}},{key:"getAndParseVAST",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(n),this.URLTemplateFilters.forEach((function(t){e=t(e)})),this.rootURL=e,this.fetchVAST(e).then((function(r){return n.previousUrl=e,n.isRootVAST=!0,n.url=e,t.parse(r,n).then((function(e){return t.buildVASTResponse(e)}))}))}},{key:"parseVAST",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.initParsingStatus(n),n.isRootVAST=!0,this.parse(e,n).then((function(e){return t.buildVASTResponse(e)}))}},{key:"buildVASTResponse",value:function(e){var t,n={ads:(t={ads:e,errorURLTemplates:this.getErrorURLTemplates(),version:this.vastVersion}).ads||[],errorURLTemplates:t.errorURLTemplates||[],version:t.version||null};return this.completeWrapperResolving(n),n}},{key:"parseVastXml",value:function(e,t){var n=t.isRootVAST,r=void 0!==n&&n,a=t.url,i=void 0===a?null:a,o=t.wrapperDepth,s=void 0===o?0:o,l=t.allowMultipleAds,d=t.followAdditionalWrappers;if(!e||!e.documentElement||"VAST"!==e.documentElement.nodeName)throw this.emit("VAST-ad-parsed",{type:"ERROR",url:i,wrapperDepth:s}),new Error("Invalid VAST XMLDocument");var u=[],c=e.documentElement.childNodes,h=e.documentElement.getAttribute("version");for(var p in r&&h&&(this.vastVersion=h),c){var f=c[p];if("Error"===f.nodeName){var g=w.parseNodeText(f);r?this.rootErrorURLTemplates.push(g):this.errorURLTemplates.push(g)}else if("Ad"===f.nodeName){if(this.vastVersion&&parseFloat(this.vastVersion)<3)l=!0;else if(!1===l&&u.length>1)break;var m=W(f,this.emit.bind(this),{allowMultipleAds:l,followAdditionalWrappers:d});m.ad?(u.push(m.ad),this.emit("VAST-ad-parsed",{type:m.type,url:i,wrapperDepth:s,adIndex:u.length-1,vastVersion:h})):this.trackVastError(this.getErrorURLTemplates(),{ERRORCODE:101})}}return u}},{key:"parse",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.url,r=void 0===n?null:n,a=t.resolveAll,i=void 0===a||a,o=t.wrapperSequence,s=void 0===o?null:o,l=t.previousUrl,d=void 0===l?null:l,u=t.wrapperDepth,c=void 0===u?0:u,h=t.isRootVAST,p=void 0!==h&&h,f=t.followAdditionalWrappers,g=t.allowMultipleAds,m=[];this.vastVersion&&parseFloat(this.vastVersion)<3&&p&&(g=!0);try{m=this.parseVastXml(e,{isRootVAST:p,url:r,wrapperDepth:c,allowMultipleAds:g,followAdditionalWrappers:f})}catch(e){return Promise.reject(e)}return 1===m.length&&null!=s&&(m[0].sequence=s),!1===i&&(this.remainingAds=w.splitVAST(m),m=this.remainingAds.shift()),this.resolveAds(m,{wrapperDepth:c,previousUrl:d,url:r})}},{key:"resolveAds",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1?arguments[1]:void 0,r=n.wrapperDepth,a=n.previousUrl,i=n.url,o=[];return a=i,t.forEach((function(t){var n=e.resolveWrappers(t,r,a);o.push(n)})),Promise.all(o).then((function(t){var n=E.flatten(t);if(!n&&e.remainingAds.length>0){var o=e.remainingAds.shift();return e.resolveAds(o,{wrapperDepth:r,previousUrl:a,url:i})}return n}))}},{key:"resolveWrappers",value:function(e,t,n){var r=this;return new Promise((function(a){var i;if(t++,!e.nextWrapperURL)return delete e.nextWrapperURL,a(e);if(t>=r.maxWrapperDepth||-1!==r.parentURLs.indexOf(e.nextWrapperURL))return e.errorCode=302,delete e.nextWrapperURL,a(e);e.nextWrapperURL=w.resolveVastAdTagURI(e.nextWrapperURL,n),r.URLTemplateFilters.forEach((function(t){e.nextWrapperURL=t(e.nextWrapperURL)}));var o=null!==(i=r.parsingOptions.allowMultipleAds)&&void 0!==i?i:e.allowMultipleAds,s=e.sequence;r.fetchVAST(e.nextWrapperURL,t,n,e).then((function(i){return r.parse(i,{url:e.nextWrapperURL,previousUrl:n,wrapperSequence:s,wrapperDepth:t,followAdditionalWrappers:e.followAdditionalWrappers,allowMultipleAds:o}).then((function(t){if(delete e.nextWrapperURL,0===t.length)return e.creatives=[],a(e);t.forEach((function(t){t&&w.mergeWrapperAdData(t,e)})),a(t)}))})).catch((function(t){e.errorCode=301,e.errorMessage=t.message,a(e)}))}))}},{key:"completeWrapperResolving",value:function(e){if(0===e.ads.length)this.trackVastError(e.errorURLTemplates,{ERRORCODE:303});else for(var t=e.ads.length-1;t>=0;t--){var n=e.ads[t];(n.errorCode||0===n.creatives.length)&&(this.trackVastError(n.errorURLTemplates.concat(e.errorURLTemplates),{ERRORCODE:n.errorCode||303},{ERRORMESSAGE:n.errorMessage||""},{extensions:n.extensions},{system:n.system}),e.ads.splice(t,1))}}}]),n}(X),se=null,le={data:{},length:0,getItem:function(e){return this.data[e]},setItem:function(e,t){this.data[e]=t,this.length=Object.keys(this.data).length},removeItem:function(e){delete this.data[e],this.length=Object.keys(this.data).length},clear:function(){this.data={},this.length=0}},de=function(){function e(){a(this,e),this.storage=this.initStorage()}return o(e,[{key:"initStorage",value:function(){if(se)return se;try{se="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(e){se=null}return se&&!this.isStorageDisabled(se)||(se=le).clear(),se}},{key:"isStorageDisabled",value:function(e){var t="__VASTStorage__";try{if(e.setItem(t,t),e.getItem(t)!==t)return e.removeItem(t),!0}catch(e){return!0}return e.removeItem(t),!1}},{key:"getItem",value:function(e){return this.storage.getItem(e)}},{key:"setItem",value:function(e,t){return this.storage.setItem(e,t)}},{key:"removeItem",value:function(e){return this.storage.removeItem(e)}},{key:"clear",value:function(){return this.storage.clear()}}]),e}(),ue=function(){function e(t,n,r){a(this,e),this.cappingFreeLunch=t||0,this.cappingMinimumTimeInterval=n||0,this.defaultOptions={withCredentials:!1,timeout:0},this.vastParser=new oe,this.storage=r||new de,void 0===this.lastSuccessfulAd&&(this.lastSuccessfulAd=0),void 0===this.totalCalls&&(this.totalCalls=0),void 0===this.totalCallsTimeout&&(this.totalCallsTimeout=0)}return o(e,[{key:"getParser",value:function(){return this.vastParser}},{key:"lastSuccessfulAd",get:function(){return this.storage.getItem("vast-client-last-successful-ad")},set:function(e){this.storage.setItem("vast-client-last-successful-ad",e)}},{key:"totalCalls",get:function(){return this.storage.getItem("vast-client-total-calls")},set:function(e){this.storage.setItem("vast-client-total-calls",e)}},{key:"totalCallsTimeout",get:function(){return this.storage.getItem("vast-client-total-calls-timeout")},set:function(e){this.storage.setItem("vast-client-total-calls-timeout",e)}},{key:"hasRemainingAds",value:function(){return this.vastParser.remainingAds.length>0}},{key:"getNextAds",value:function(e){return this.vastParser.getRemainingAds(e)}},{key:"get",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=Date.now();return(n=Object.assign({},this.defaultOptions,n)).hasOwnProperty("resolveAll")||(n.resolveAll=!1),this.totalCallsTimeout<r?(this.totalCalls=1,this.totalCallsTimeout=r+36e5):this.totalCalls++,new Promise((function(a,i){if(t.cappingFreeLunch>=t.totalCalls)return i(new Error("VAST call canceled – FreeLunch capping not reached yet ".concat(t.totalCalls,"/").concat(t.cappingFreeLunch)));var o=r-t.lastSuccessfulAd;if(o<0)t.lastSuccessfulAd=0;else if(o<t.cappingMinimumTimeInterval)return i(new Error("VAST call canceled – (".concat(t.cappingMinimumTimeInterval,")ms minimum interval reached")));t.vastParser.getAndParseVAST(e,n).then((function(e){return a(e)})).catch((function(e){return i(e)}))}))}}]),e}(),ce=function(e){l(i,e);var t=h(i);function i(e,n,r){var o,s=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;for(var l in a(this,i),(o=t.call(this)).ad=n,o.creative=r,o.variation=s,o.muted=!1,o.impressed=!1,o.skippable=!1,o.trackingEvents={},o.lastPercentage=0,o._alreadyTriggeredQuartiles={},o.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","resume","pause","rewind","skip","closeLinear","close"],o.creative.trackingEvents){var d=o.creative.trackingEvents[l];o.trackingEvents[l]=d.slice(0)}return N(o.creative)?o._initLinearTracking():o._initVariationTracking(),e&&o.on("start",(function(){e.lastSuccessfulAd=Date.now()})),o}return o(i,[{key:"_initLinearTracking",value:function(){this.linear=!0,this.skipDelay=this.creative.skipDelay,this.setDuration(this.creative.duration),this.clickThroughURLTemplate=this.creative.videoClickThroughURLTemplate,this.clickTrackingURLTemplates=this.creative.videoClickTrackingURLTemplates}},{key:"_initVariationTracking",value:function(){if(this.linear=!1,this.skipDelay=-1,this.variation){for(var e in this.variation.trackingEvents){var t=this.variation.trackingEvents[e];this.trackingEvents[e]?this.trackingEvents[e]=this.trackingEvents[e].concat(t.slice(0)):this.trackingEvents[e]=t.slice(0)}"nonLinearAd"===this.variation.adType?(this.clickThroughURLTemplate=this.variation.nonlinearClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.nonlinearClickTrackingURLTemplates,this.setDuration(this.variation.minSuggestedDuration)):function(e){return"companionAd"===e.adType}(this.variation)&&(this.clickThroughURLTemplate=this.variation.companionClickThroughURLTemplate,this.clickTrackingURLTemplates=this.variation.companionClickTrackingURLTemplates)}}},{key:"setDuration",value:function(e){E.isValidTimeValue(e)&&(this.assetDuration=e,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100})}},{key:"setProgress",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(E.isValidTimeValue(e)&&"object"===r(n)){var a=this.skipDelay||-1;if(-1===a||this.skippable||(a>e?this.emit("skip-countdown",a-e):(this.skippable=!0,this.emit("skip-countdown",0))),this.assetDuration>0){var i=Math.round(e/this.assetDuration*100),o=[];if(e>0){o.push("start");for(var s=this.lastPercentage;s<i;s++)o.push("progress-".concat(s+1,"%"));for(var l in o.push("progress-".concat(Math.round(e))),this.quartiles)this.isQuartileReached(l,this.quartiles[l],e)&&(o.push(l),this._alreadyTriggeredQuartiles[l]=!0);this.lastPercentage=i}o.forEach((function(e){t.track(e,{macros:n,once:!0})})),e<this.progress&&this.track("rewind",{macros:n})}this.progress=e}}},{key:"isQuartileReached",value:function(e,t,n){var r=!1;return t<=n&&!this._alreadyTriggeredQuartiles[e]&&(r=!0),r}},{key:"setMuted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"boolean"==typeof e&&"object"===r(t)&&(this.muted!==e&&this.track(e?"mute":"unmute",{macros:t}),this.muted=e)}},{key:"setPaused",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"boolean"==typeof e&&"object"===r(t)&&(this.paused!==e&&this.track(e?"pause":"resume",{macros:t}),this.paused=e)}},{key:"setFullscreen",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"boolean"==typeof e&&"object"===r(t)&&(this.fullscreen!==e&&this.track(e?"fullscreen":"exitFullscreen",{macros:t}),this.fullscreen=e)}},{key:"setExpand",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"boolean"==typeof e&&"object"===r(t)&&(this.expanded!==e&&(this.track(e?"expand":"collapse",{macros:t}),this.track(e?"playerExpand":"playerCollapse",{macros:t})),this.expanded=e)}},{key:"setSkipDelay",value:function(e){E.isValidTimeValue(e)&&(this.skipDelay=e)}},{key:"trackImpression",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===r(e)&&(this.impressed||(this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates,e),this.track("creativeView",{macros:e})))}},{key:"error",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"object"===r(e)&&"boolean"==typeof t&&this.trackURLs(this.ad.errorURLTemplates,e,{isCustomCode:t})}},{key:"errorWithCode",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];"string"==typeof e&&"boolean"==typeof t&&(this.error({ERRORCODE:e},t),console.log("The method errorWithCode is deprecated, please use vast tracker error method instead"))}},{key:"complete",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===r(e)&&this.track("complete",{macros:e})}},{key:"notUsed",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===r(e)&&(this.track("notUsed",{macros:e}),this.trackingEvents=[])}},{key:"otherAdInteraction",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===r(e)&&this.track("otherAdInteraction",{macros:e})}},{key:"acceptInvitation",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===r(e)&&this.track("acceptInvitation",{macros:e})}},{key:"adExpand",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===r(e)&&this.track("adExpand",{macros:e})}},{key:"adCollapse",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===r(e)&&this.track("adCollapse",{macros:e})}},{key:"minimize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===r(e)&&this.track("minimize",{macros:e})}},{key:"verificationNotExecuted",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof e&&"object"===r(t)){if(!this.ad||!this.ad.adVerifications||!this.ad.adVerifications.length)throw new Error("No adVerifications provided");if(!e)throw new Error("No vendor provided, unable to find associated verificationNotExecuted");var n=this.ad.adVerifications.find((function(t){return t.vendor===e}));if(!n)throw new Error("No associated verification element found for vendor: ".concat(e));var a=n.trackingEvents;if(a&&a.verificationNotExecuted){var i=a.verificationNotExecuted;this.trackURLs(i,t),this.emit("verificationNotExecuted",{trackingURLTemplates:i})}}}},{key:"overlayViewDuration",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};"string"==typeof e&&"object"===r(t)&&(t.ADPLAYHEAD=e,this.track("overlayViewDuration",{macros:t}))}},{key:"close",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===r(e)&&this.track(this.linear?"closeLinear":"close",{macros:e})}},{key:"skip",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===r(e)&&this.track("skip",{macros:e})}},{key:"load",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};"object"===r(e)&&this.track("loaded",{macros:e})}},{key:"click",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if((null===e||"string"==typeof e)&&"object"===r(t)){this.clickTrackingURLTemplates&&this.clickTrackingURLTemplates.length&&this.trackURLs(this.clickTrackingURLTemplates,t);var a=this.clickThroughURLTemplate||e,i=n({},t);if(a){this.progress&&(i.ADPLAYHEAD=this.progressFormatted());var o=E.resolveURLTemplates([a],i)[0];this.emit("clickthrough",o)}}}},{key:"track",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=t.macros,a=void 0===n?{}:n,i=t.once,o=void 0!==i&&i;if("object"===r(a)){"closeLinear"===e&&!this.trackingEvents[e]&&this.trackingEvents.close&&(e="close");var s=this.trackingEvents[e],l=this.emitAlwaysEvents.indexOf(e)>-1;s?(this.emit(e,{trackingURLTemplates:s}),this.trackURLs(s,a)):l&&this.emit(e,null),o&&(delete this.trackingEvents[e],l&&this.emitAlwaysEvents.splice(this.emitAlwaysEvents.indexOf(e),1))}}},{key:"trackURLs",value:function(e){var t,r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=n({},arguments.length>1&&void 0!==arguments[1]?arguments[1]:{});this.linear&&(this.creative&&this.creative.mediaFiles&&this.creative.mediaFiles[0]&&this.creative.mediaFiles[0].fileURL&&(i.ASSETURI=this.creative.mediaFiles[0].fileURL),this.progress&&(i.ADPLAYHEAD=this.progressFormatted())),null!==(t=this.creative)&&void 0!==t&&null!==(r=t.universalAdIds)&&void 0!==r&&r.length&&(i.UNIVERSALADID=this.creative.universalAdIds.map((function(e){return e.idRegistry.concat(" ",e.value)})).join(",")),this.ad&&(this.ad.sequence&&(i.PODSEQUENCE=this.ad.sequence),this.ad.adType&&(i.ADTYPE=this.ad.adType),this.ad.adServingId&&(i.ADSERVINGID=this.ad.adServingId),this.ad.categories&&this.ad.categories.length&&(i.ADCATEGORIES=this.ad.categories.map((function(e){return e.value})).join(",")),this.ad.blockedAdCategories&&this.ad.blockedAdCategories.length&&(i.BLOCKEDADCATEGORIES=this.ad.blockedAdCategories)),E.track(e,i,a)}},{key:"convertToTimecode",value:function(e){if(!E.isValidTimeValue(e))return"";var t=1e3*e,n=Math.floor(t/36e5),r=Math.floor(t/6e4%60),a=Math.floor(t/1e3%60),i=Math.floor(t%1e3);return"".concat(E.addLeadingZeros(n,2),":").concat(E.addLeadingZeros(r,2),":").concat(E.addLeadingZeros(a,2),".").concat(E.addLeadingZeros(i,3))}},{key:"progressFormatted",value:function(){return this.convertToTimecode(this.progress)}}]),i}(X);e.VASTClient=ue,e.VASTParser=oe,e.VASTTracker=ce,Object.defineProperty(e,"__esModule",{value:!0})})(oe.exports);const se=new WeakMap;class le{constructor(){se.set(this,{})}on(e,t){const n=se.get(this);return n[e]||(n[e]=[]),n[e].push(t),this}once(e,t){const n=(...r)=>{this.off(e,n),t(...r)};return this.on(e,n),this}off(e,t){const n=se.get(this)[e];return n&&(null===t?n.length=0:n.splice(n.indexOf(t),1)),this}listeners(e){try{return se.get(this)[e]}catch(e){return null}}emit(e,...t){const n=se.get(this)[e];return n&&n.length?(n.forEach((n=>{n({type:e,target:this},...t)})),!0):this}emitAsync(e,...t){const n=se.get(this)[e],r=[];return n&&n.length&&n.forEach((n=>{r.push(n({type:e,target:this},...t))})),Promise.all(r)}}class de extends le{constructor(e,t){super(),this.config=e,this.player=t,this.state={},this.originalPlayerState={}}init(){this.player.ads(this.config),this.setupAdEvents(),this.config.playMidroll&&this.initMidrollCues()}initMidrollCues(){this.player.on("loadstart",(()=>{if(this.config.playPreroll){const e=()=>{!this.player.ads.isInAdMode()||this.player.ads.isContentResuming()?(this.player.off("adscanceled",t),this.setupMidrolls()):this.player.one("contentloadedmetadata",e)},t=()=>{e(),this.onNoPreroll()};this.player.one("contentloadedmetadata",e),this.player.one("adscanceled",t)}else this.player.one("loadedmetadata",(()=>this.setupMidrolls()))}))}setupMidrolls(){try{this.player.adsConfig.contentDuration=this.player.duration(),this.processCues(),this.player.ads.cueTextTracks.processMetadataTracks(this.player,((e,t)=>{"ad-cues"===t.label&&(this.cueMap=new Map,this.adCueTrack=t,t.cues_.forEach((e=>{this.cueMap.set(e.startTime,{played:!1})})),this.emit("adcues",t.cues_),this.onCueChangeRef&&t.removeEventListener("cuechange",this.onCueChangeRef),this.onCueChangeRef=e=>this.adCueChange(t.activeCues),t.addEventListener("cuechange",this.onCueChangeRef))}))}catch(e){}}processCues(){}triggerAdsReady(){this.player.trigger("adsready")}setupAdEvents(){const e=this.player;e.on("contentchanged",(()=>this.onContentChanged())),e.on("adsready",(()=>this.onAdsReady())),e.on("readyforpreroll",(()=>this.onReadyForPreroll())),e.on("readyforpostroll",(()=>this.onReadyForPostroll())),e.ready((()=>{this.controlsEnabled=e.controls()})),e.on("ads-ad-started",(()=>{try{e.controls(!1),e.controlBar.progressControl.disable()}catch(e){}})),e.on("ads-ad-ended",(()=>{try{e.controls(this.controlsEnabled),e.toggleClass("vjs-ad-content-resuming",!1),e.controlBar.progressControl.enable()}catch(e){}}))}onContentChanged(){}onAdsReady(){}onReadyForPreroll(){this.player.trigger("nopreroll")}onReadyForPostroll(){}adCueChange(e){if(e.length){const t=e[e.length-1],n=[t],r=(e,n,r,a)=>{this.cueMap.get(a).played||(this.player.trigger("admidrollstart",t),this.startOnAdCue(t),this.cueMap.get(a).played=!0)};this.player.ads.cueTextTracks.processAdTrack(this.player,n,r)}else this.stopOnAdCue()}}class ue extends de{constructor(e,t){super(e,t),t.adsConfig.vast=!0,t.ads._shouldBlockPlay=!0,this.adSlotIndex=0,this.adSlotTotalDuration=e.adSlotPrerollDuration,t.adsConfig.adSlotIndex=1,t.adsConfig.adSlotsTotal=1,this.vastClient=new oe.exports.VASTClient}init(){this.config.stitchedAds=!1,super.init(),this.getVast(this.config,!0)}onNoPreroll(){this.getVast(this.config,!1)}processCues(){this.adCueTrack?this.adCueTrack.mode="hidden":this.adCueTrack=this.player.addTextTrack("metadata","ad-cues","en");const e=window.WebKitDataCue||window.VTTCue;if(this.config.midrollInterval)for(let t=this.config.midrollInterval;t<this.player.duration();t+=this.config.midrollInterval){const n=60*t;this.adCueTrack.addCue(new e(n,n+1,""))}}onContentChanged(){this.getVast(this.config)}onAdsReady(){this.config.playPreroll||this.player.trigger("nopreroll")}onReadyForPreroll(){!this.state.prerollPlayed&&this.config.playPreroll?(this.state.prerollPlayed=!0,this._playAd(this.vastCreative)):this.player.trigger("nopreroll")}onReadyForPostroll(){!this.state.postrollPlayed&&this.config.playPostroll?(this.state.postrollPlayed=!0,this._playAd(this.vastCreative)):this.player.trigger("nopostroll")}setupAdEvents(){super.setupAdEvents();const e=this.player;let t=e.muted(),n=e.volume();e.one("adended",(()=>{this.adSlotTotalDuration=this.config.adSlotMidrollDuration})),e.one("adcanplay",(()=>{})),e.on("addurationchange",(()=>{this.tracker&&this.tracker.setDuration(e.duration())})),e.on("adtimeupdate",(()=>{this.tracker&&this.tracker.setProgress(e.currentTime())})),e.on("adpause",(()=>{this.tracker&&(this.tracker.setPaused(!0),e.one("adplay",(()=>{this.tracker.setPaused(!1)})))})),e.on("aderror",(()=>{this.tracker&&this.tracker.errorWithCode("405"),e.trigger("adended")})),e.on("advolumechange",(()=>{const r=e.volume(),a=e.muted();t!==a?(this.tracker.setMuted(a),t=a):n!==r&&(n>0&&0===r?this.tracker.setMuted(!0):0===n&&r>0&&this.tracker.setMuted(!1),n=r)}))}startOnAdCue(e){this.vastCreative&&this._playAd(this.vastCreative)}stopOnAdCue(){}async getVast(e,t=!1){e.apsURL?this.requestAPS(e.apsURL,t):e.url&&this.requestAds(e.url,t)}async requestAPS(e,t=!1){try{const n=await fetch(e);let r;if(n){const e=await n.json();r=this.resolvedVastURL=e.content.vast_url}else this.resolvedVastURL&&(r=this.resolvedVastURL);this.player.trigger("resolvedvasturl",r),this.requestAds(r,t)}catch(e){try{this.player.trigger("adscanceled")}catch(e){}console.log(`Ad cancelled: ${e.message}`)}}requestAds(e,t=!1){this.state={},e=e+=`&preroll=${t}`,this._getVastContent(e).then((e=>this._handleVast(e,t))).catch((e=>{try{this.player.trigger("adscanceled")}catch(e){}console.log(`Ad cancelled: ${e.message}`)}))}_handleVast(e,t=!1){if(!e.ads||0===e.ads.length)return void this.player.trigger("adscanceled");let n=-1,r=-1;this.ads=e.ads.map(((e,t,r)=>{const a=e.creatives.filter((e=>"linear"===e.type))[0],i=new oe.exports.VASTTracker(this.vastClient,e,a,null);return e.tracker=i,a.sources=[a.mediaFiles.map((e=>({type:e.mimeType,src:e.fileURL})))[0]],e.linearCreative=a,e.duration=a.duration,n+=e.duration,i.on("clickthrough",(e=>{window$.open(e,"_blank")})),e})).filter((e=>{if(e.description&&e.description.indexOf("Mid-roll")>-1)return!1;const t=this.adSlotTotalDuration;return!(t&&n>t)||(r+=e.duration,r<=t)}));try{this.player.adsConfig.adTagDuration=this.ads.map((e=>e.duration)).reduce(((e,t)=>e+t))}catch(e){}this.player.adsConfig.adSlotsTotal=this.ads.length,this.player.trigger("vastads",this.ads);const a=this.ads[0].linearCreative;this.setupCreative(this.ads[0]),t&&(a.sources.length?this.triggerAdsReady():this.player.trigger("adscanceled"))}setupCreative(e){this.vastCreative=e.linearCreative,this.tracker=e.tracker}_getVastContent(e){return this.vastClient.get(e,{withCredentials:this.config.withCredentials,wrapperLimit:this.config.wrapperLimit})}_playAd(e){const t=this.player,n=this.ads[this.adSlotIndex];t.one("adloadstart",(()=>{const e=n.tracker;e&&e.load()})),t.one("adcanplay",(()=>{const e=n.tracker;e&&e.trackImpression()})),t.one("adended",(()=>{const e=n.tracker;e&&e.complete()})),t.one("adstart",(()=>{t.toggleClass("vjs-ad-content-resuming",!0),t.trigger("ads-ad-started")})),0==this.adSlotIndex&&t.ads.startLinearAdMode(),t.src(e.sources);let r=null;this.ads.length&&(this.adSlotIndex++,t.adsConfig.adSlotIndex=this.adSlotIndex,r=this.ads[this.adSlotIndex]),t.one("adended",(()=>{r?(this.setupCreative(r),t.trigger("adslot",r),this._playAd(this.vastCreative)):(t.one("contentloadedmetadata",(()=>{this.getVast(this.config)})),this.adCueTrack&&(this.adCueTrack.mode="hidden"),t.ads.endLinearAdMode(),t.trigger("ads-ad-ended"),this.adSlotIndex=t.adsConfig.adSlotIndex=0)}))}}class ce extends de{constructor(e,t){super(e,t)}set adDuration(e){this.player.adsConfig.adTagDuration=e}init(){super.init()}initMidrollCues(){this.player.on("loadedmetadata",(()=>{this.triggerAdsReady(),this.setupMidrolls()}))}onContentChanged(){this.triggerAdsReady()}setupAdEvents(){super.setupAdEvents();const e=this.player;e.on("adended",(()=>{e.trigger("ads-ad-ended")}))}startOnAdCue(e){const t=this.player;this.adDuration=this.player.currentTime()+(e.endTime-e.startTime),t.trigger("addurationchange"),t.ads.startLinearAdMode(),t.trigger("ads-ad-started")}stopOnAdCue(){const e=this.player;e.trigger("ads-ad-ended"),e.trigger("adended")}}class he{static getAdsManager(e,t){return"vast"===e.type?new ue(e,t):new ce(e,t)}}const pe=n.default.getPlugin("plugin");n.default.registerPlugin("onestudioads",class extends pe{constructor(e,t){super(e,t);const r=n.default.mergeOptions({skipad:"Skip Ad",skippable:!1,skipDelay:5,adURLDelay:5,seekEnabled:!1,controlsEnabled:!1,wrapperLimit:10,withCredentials:!0,midrollInterval:7,midrollSeek:!1,playMidroll:!0,playPreroll:!0,playPostroll:!1,stitchedAds:!0,adMarkers:!1,adSlotPrerollDuration:150,adSlotMidrollDuration:150,type:"vast"},t);e.adsConfig=r,this.adsManager=he.getAdsManager(r,e),r.adMarkers&&this.adsManager.on("adcues",((e,t)=>this.setAdCueMarkers(t))),this.adsManager.init(),this.setupAdsUI(r)}setupAdsUI(e){const t=this.player.addChild("AdsUI");if(e.skippable){t.addChild("adSkipButton").skipDelay=e.skipDelay}}setAdCueMarkers(e){const t=this.player.getChild("ControlBar").getChild("progressControl").getChild("seekBar"),n=t.el_;parseFloat(getComputedStyle(n).width);const r=t.getChild("mouseTimeDisplay");let a;r&&(a=r.getChild("timeTooltip"),a.el_.style.width="max-content");const i=n.querySelector(".vjs-ads-cue");i&&i.length&&i.forEach((e=>{e.parentNode.removeChild(e)})),e.forEach((e=>{const t=document.createElement("div");t.setAttribute("role","button"),t.style.left=(e.startTime/this.player.duration()*100).toString()+"%",t.style.width="0.5em",t.style.height="100%",t.style.backgroundColor="#CCCCCC",t.style.position="absolute",t.style.zIndex=100,t.className="vjs-ads-cue",t.addEventListener("click",(t=>{this.player.currentTime(e.startTime-.5)})),n.appendChild(t)}))}})}(videojs);
